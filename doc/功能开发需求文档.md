# 基于Web的校园帮系统 - 功能开发需求文档

## 一、项目概述

### 1.1 项目背景

本项目旨在设计并实现一个基于 Spring Boot + Vue 的校园帮系统，通过该系统实现对失物招领、闲置交易、跑腿服务等校园互助场景的统一管理。系统将服务于高校师生，提供一个全面、便捷、安全的校园互助平台，解决传统互助渠道信息分散、效率低的问题。

### 1.2 项目目标

- 整合校园内各类互助服务，提供统一的信息发布和管理平台
- 提高校园互助服务的效率和用户体验
- 建立完善的信用评价体系，保障交易安全
- 实现实时消息通知，提升用户参与度
- 提供数据统计分析功能，支持运营决策

### 1.3 技术架构

**后端技术栈：**
- Spring Boot 2.7.18
- MyBatis-Plus 3.5.3
- Spring Security + JWT
- Redis（缓存和会话管理）
- MySQL 8.0
- WebSocket（实时消息）
- Spring Mail（邮件通知）

**前端技术栈：**
- Vue 3.x
- Vite
- Element Plus
- Pinia
- Vue Router
- Axios
- ECharts
- WebSocket客户端

## 二、功能需求详细说明

### 2.1 用户管理模块

#### 2.1.1 用户注册与登录
- **注册功能**
  - 仅支持邮箱注册
  - 邮箱唯一性验证（每个邮箱只能注册一个账号）
  - 邮箱验证码验证
  - 密码强度校验（至少8位，包含字母和数字）
  - 用户协议和隐私政策确认
  
- **登录功能**
  - 仅支持邮箱登录
  - 密码登录
  - 验证码登录（邮箱验证码）
  - 记住登录状态（7天）
  - JWT Token认证

#### 2.1.2 用户信息管理
- 个人资料编辑（昵称、头像、性别、年级、专业等）
- 实名认证（学生证/教师证认证）
- 信用积分查看
- 交易记录查看
- 收藏管理

#### 2.1.3 用户角色与权限

系统包含以下角色：

- **普通用户（USER）**
  - 基础权限：注册、登录、浏览信息
  - 发布权限：发布失物招领、发布闲置商品、发布跑腿任务
  - 交互权限：评论、收藏、私信沟通
  - 交易权限：认领失物、购买商品
  - 跑腿权限：实名认证后即可接单跑腿任务（无需管理员审核）
  - 管理权限：管理自己发布的信息、订单、任务
  - **用户状态说明：**
    - **实名认证状态**（`is_verified`）：未认证/已认证
      - 已认证用户：发布的信息优先展示、显示认证标识和信用等级
      - **实名认证后自动获得接单权限**：`can_accept_task` 自动设置为可接单
    - **跑腿接单权限**（`can_accept_task`）：不可接单/可接单
      - 实名认证后自动获得接单权限，无需额外申请
      - 可接单用户：可以接取跑腿任务、查看跑腿统计、显示跑腿员等级

- **管理员（ADMIN）**
  - 所有普通用户权限
  - 管理权限：
    - 信息审核：审核失物招领、商品、跑腿任务
    - 用户管理：查看用户列表、禁用/启用用户、查看用户详情、审核实名认证
    - 数据统计：查看系统统计数据、生成报表
    - 系统配置：管理系统配置参数
    - 系统公告：发布系统公告

### 2.2 失物招领模块

#### 2.2.1 失物发布
- 发布失物信息
  - 物品名称（必填）
  - 物品分类（必填）：证件类、电子产品、生活用品、书籍、其他
  - 物品描述（必填）
  - 丢失时间（必填）
  - 丢失地点（必填）
  - 联系方式（可选，可通过私信联系）
  - 物品图片（最多9张）
  - 悬赏金额（可选）
  
- 信息审核
  - 管理员审核机制
  - 自动过滤敏感词
  - 审核状态：待审核、已通过、已拒绝

#### 2.2.2 失物浏览与搜索
- 列表展示
  - 按时间排序（最新优先）
  - 按分类筛选
  - 按状态筛选（待认领、已认领、已关闭）
  - 分页加载
  
- 搜索功能
  - 关键词搜索（物品名称、描述）
  - 高级搜索（分类、时间范围、地点）
  
- 详情查看
  - 物品详细信息
  - 发布者信息（昵称、信用等级）
  - 认领记录
  - 评论列表

#### 2.2.3 认领功能
- 认领申请
  - 提交认领信息（描述物品特征、丢失时间等）
  - 上传相关证明（可选）
  - 提交认领后，系统自动创建私信会话，方便双方沟通
  
- 认领处理
  - 发布者确认认领
  - **私信沟通**：双方通过站内私信功能协商交接方式、时间、地点等细节
  - 实时消息通知：认领申请、确认、拒绝等操作会通过WebSocket实时通知对方
  - 完成认领后关闭信息

#### 2.2.4 状态管理
- **待认领**：信息已发布，等待认领
- **认领中**：有用户申请认领，等待确认
- **已认领**：认领成功，物品已归还
- **已关闭**：信息过期或发布者主动关闭

#### 2.2.5 失物认领状态流转控制

**状态流转规则：**
- 待认领 → 认领中（有用户申请认领）
- 认领中 → 已认领（发布者确认认领）
- 认领中 → 待认领（发布者拒绝认领）
- 任何状态 → 已关闭（发布者关闭/超时关闭）

**需要注意的技术点：**

1. **并发认领控制**
   - 多个用户同时申请认领同一失物时，只允许第一个申请者进入"认领中"状态
   - 使用乐观锁（version字段）或分布式锁防止并发认领
   - 其他申请者需要等待第一个认领结果

2. **认领超时处理**
   - 认领中超过7天未确认，自动提醒发布者
   - 认领中超过14天未确认，自动拒绝认领，恢复为"待认领"
   - 使用定时任务（Spring Task Scheduler）定期检查超时认领

3. **认领记录管理**
   - 记录所有认领申请历史，即使被拒绝也要保留记录
   - 便于发布者查看认领记录和选择认领者

4. **状态变更权限**
   - 只有失物发布者才能确认/拒绝认领
   - 只有认领申请者才能取消认领申请
   - 状态变更前验证操作者身份和权限

5. **状态变更幂等性**
   - 状态变更接口需要支持幂等性
   - 重复调用相同状态变更操作，应该返回成功但不重复执行

6. **事务处理**
   - 认领确认时，失物状态变更 + 认领记录更新 + 消息通知，需要在同一事务中完成

### 2.3 闲置交易模块

#### 2.3.1 商品发布
- 发布闲置商品
  - 商品名称（必填）
  - 商品分类（必填）：电子产品、书籍、生活用品、服装、其他
  - 商品描述（必填）
  - 原价（必填）
  - 现价（必填）
  - 商品图片（至少1张，最多9张）
  - 交易方式：面交、邮寄
  - 交易地点（面交必填）
  - 联系方式（可选，可通过私信联系）
  
- 信息审核
  - 管理员审核
  - 价格合理性检查
  - 图片质量检查

#### 2.3.2 商品浏览与搜索
- 列表展示
  - 按时间排序
  - 按价格排序
  - 按分类筛选
  - 按交易方式筛选
  - 分页加载
  
- 搜索功能
  - 关键词搜索
  - 价格区间筛选
  - 分类筛选
  
- 详情查看
  - 商品详细信息
  - 卖家信息（信用等级、好评率）
  - 商品图片轮播
  - 评论列表

#### 2.3.3 交易流程
- **下单流程**
  1. 买家浏览商品
  2. **私信沟通**：买家通过站内私信联系卖家，咨询商品详情、价格、交易方式等
  3. 确认交易信息：双方通过私信确认交易细节（价格、地点、时间等）
  4. 创建订单：买家创建订单，系统自动创建订单相关的私信会话
  5. 支付（面交可跳过）：邮寄交易需要支付（模拟支付，不调用外部接口），面交可跳过此步骤
  6. **私信协调**：双方通过私信约定发货时间/面交时间地点
  7. 等待发货/约定面交时间：订单状态变更会实时通知双方
  8. 确认收货：买家确认收货，系统通知卖家
  9. 评价：交易完成后双方可互相评价

- **订单状态**
  - **待付款**：订单已创建，等待支付
  - **待发货**：已付款，等待卖家发货
  - **待收货**：已发货，等待买家收货
  - **待评价**：已收货，等待评价
  - **已完成**：交易完成
  - **已取消**：订单取消
  - **退款中**：申请退款
  - **已退款**：退款完成

#### 2.3.4 订单状态流转控制

**状态流转规则：**
- 待付款 → 待发货（支付成功）
- 待付款 → 已取消（买家取消/超时取消）
- 待发货 → 待收货（卖家发货）
- 待发货 → 已取消（卖家取消）
- 待收货 → 待评价（买家确认收货）
- 待收货 → 退款中（买家申请退款）
- 待评价 → 已完成（双方评价完成）
- 退款中 → 已退款（退款成功）
- 退款中 → 待收货（退款被拒绝）

**需要注意的技术点：**

1. **并发控制**
   - 使用乐观锁（version字段）防止并发状态修改
   - 状态变更时使用 `UPDATE ... WHERE status=#{oldStatus} AND version=#{version}`
   - 如果更新失败，说明状态已被其他操作修改，返回错误提示

2. **状态变更幂等性**
   - 状态变更接口需要支持幂等性
   - 重复调用相同状态变更操作，应该返回成功但不重复执行
   - 使用唯一标识（如订单号+状态）记录状态变更历史

3. **事务处理**
   - 状态变更涉及多表操作时，使用数据库事务保证一致性
   - 例如：订单状态变更 + 商品状态更新 + 消息通知，需要在同一事务中完成

4. **超时处理**
   - 待付款订单：超过30分钟未支付自动取消
   - 待发货订单：超过7天未发货自动提醒
   - 待收货订单：超过7天自动确认收货（邮寄交易）
   - 使用定时任务（Spring Task Scheduler）定期检查超时订单

5. **状态回滚机制**
   - 支付失败时，订单状态回滚到"待付款"
   - 发货失败时，订单状态回滚到"待发货"
   - 退款处理时，需要回滚订单状态和相关数据

6. **权限验证**
   - 只有订单相关方（买家/卖家）才能操作订单状态
   - 状态变更前验证操作者身份和权限
   - 记录操作日志，便于追溯

#### 2.3.5 支付流程（模拟支付）

**支付说明：**
- 使用模拟支付，不调用外部支付接口
- 支付流程在系统内部完成，仅用于演示和测试

**需要注意的技术点：**

1. **支付幂等性**
   - 支付接口需要支持幂等性，防止重复支付
   - 使用订单号+支付流水号作为唯一标识
   - 重复支付请求返回已支付状态，不重复扣款

2. **支付超时处理**
   - 待付款订单超过30分钟未支付，自动取消订单
   - 支付过程中断，订单状态回滚到"待付款"

3. **支付处理流程**
   - 支付请求：验证订单状态、金额、用户信息
   - 支付处理：模拟扣款，更新订单状态为"待发货"
   - 支付记录：保存支付记录，便于对账和查询

4. **资金安全**
   - 支付金额需要与订单金额严格匹配
   - 支付记录需要完整保存，便于对账
   - 支付信息需要加密存储（虽然为模拟支付）

5. **退款处理**
   - 退款申请：买家申请退款，订单状态变更为"退款中"
   - 退款处理：卖家确认退款，模拟退款，更新订单状态为"已退款"
   - 退款记录：保存退款记录，便于追溯

#### 2.3.6 商品状态管理

**状态流转规则：**
- 在售 → 已售出（订单完成）
- 在售 → 已下架（卖家下架）
- 已下架 → 在售（卖家重新上架）

**需要注意的技术点：**

1. **并发下单控制**
   - 多个买家同时下单同一商品时，只允许第一个订单成功
   - 使用乐观锁（version字段）或分布式锁防止并发下单
   - 商品状态从"在售"变更为"已售出"时，需要原子性操作

2. **商品库存管理**（如果支持多件商品）
   - 下单时检查库存是否充足
   - 使用乐观锁控制库存扣减
   - 库存不足时，订单创建失败

3. **状态变更权限**
   - 只有商品卖家才能下架/上架商品
   - 订单完成时，系统自动更新商品状态为"已售出"

#### 2.3.7 评价系统
- 交易完成后双方可互相评价
- 评价维度：描述相符、服务态度、物流速度
- 星级评分（1-5星）
- 文字评价
- 评价展示在用户主页

### 2.4 跑腿服务模块

#### 2.4.1 跑腿任务发布
- 发布跑腿任务
  - 任务类型（必填）：代取快递、代买物品、代送物品、其他
  - 任务标题（必填）
  - 任务描述（必填）
  - 起始地点（必填）
  - 目的地（必填）
  - 期望完成时间（必填）
  - 报酬金额（必填）
  - 联系方式（可选，可通过私信联系）
  - 任务图片（可选，最多3张）
  
- 信息审核
  - 管理员审核
  - 价格合理性检查

#### 2.4.2 跑腿任务浏览
- 列表展示
  - 按时间排序
  - 按报酬排序
  - 按类型筛选
  - 按状态筛选
  - 分页加载
  
- 搜索功能
  - 关键词搜索
  - 地点搜索
  - 类型筛选
  - 报酬区间筛选

#### 2.4.3 跑腿任务接单
- 接单流程
  1. 浏览任务列表
  2. 查看任务详情
  3. 确认接单：用户接单后，系统自动创建任务相关的私信会话
  4. 系统创建跑腿订单
  5. **私信沟通**：双方通过站内私信确认任务详细信息（具体地点、时间、要求等）
  6. 开始执行任务：接单用户开始任务，系统通知发布者
  7. **进度更新**：接单用户可通过私信向发布者更新任务进度
  8. 完成任务：接单用户完成任务，系统通知发布者
  9. 确认完成：发布者确认完成，系统通知接单用户
  10. 支付报酬：系统自动处理报酬支付（模拟支付，不调用外部接口），通知双方
  11. 评价：任务完成后双方可互相评价

#### 2.4.4 跑腿任务状态流转

**完整状态流程：**

1. **待接单**（PENDING）
   - 任务已发布，等待用户接单
   - 可操作：接单、取消任务

2. **已接单**（ACCEPTED）
   - 用户已接单，等待确认
   - 可操作：确认接单、取消接单、开始任务

3. **进行中**（IN_PROGRESS）
   - 接单用户已开始执行任务
   - 可操作：更新进度、完成任务、取消任务

4. **待确认**（PENDING_CONFIRM）
   - 接单用户已完成任务，等待发布者确认
   - 可操作：确认完成、申请取消

5. **已完成**（COMPLETED）
   - 任务已完成，报酬已支付
   - 可操作：评价

6. **已取消**（CANCELLED）
   - 任务已取消
   - 取消原因：发布者取消、接单用户取消、超时取消

7. **申诉中**（APPEALING）
   - 任务出现争议，进入申诉流程
   - 可操作：提交申诉、处理申诉

8. **申诉完成**（APPEAL_COMPLETED）
   - 申诉已处理完成

**状态转换规则：**
- 待接单 → 已接单（用户接单）
- 已接单 → 进行中（接单用户开始任务）
- 已接单 → 已取消（双方取消）
- 进行中 → 待确认（接单用户完成任务）
- 进行中 → 已取消（双方取消）
- 待确认 → 已完成（发布者确认）
- 待确认 → 申诉中（双方申请）
- 任何状态 → 申诉中（出现争议）
- 申诉中 → 已完成/已取消（申诉处理结果）

#### 2.4.7 跑腿任务状态流转控制

**需要注意的技术点：**

1. **并发控制**（已在2.4.6中说明）
   - 接单使用乐观锁防止并发
   - 状态变更使用乐观锁保证原子性

2. **超时处理**
   - 已接单超过24小时未开始，自动提醒接单用户
   - 进行中超过期望完成时间，自动提醒接单用户
   - 待确认超过48小时未确认，自动提醒发布者
   - 使用定时任务（Spring Task Scheduler）定期检查超时任务

3. **状态变更权限**
   - 只有任务相关方（发布者/接单用户）才能操作任务状态
   - 不同状态下的操作权限不同，需要严格验证

4. **报酬支付**（模拟支付）
   - 任务完成确认后，自动处理报酬支付（模拟支付，不调用外部接口）
   - 支付失败时，任务状态回滚到"待确认"
   - 支付成功后，更新用户信用积分

5. **状态变更幂等性**
   - 状态变更接口需要支持幂等性
   - 重复调用相同状态变更操作，应该返回成功但不重复执行

6. **事务处理**
   - 状态变更涉及多表操作时，使用数据库事务保证一致性
   - 例如：任务状态变更 + 订单状态更新 + 消息通知，需要在同一事务中完成

#### 2.4.5 跑腿接单权限
- 接单权限获取
  - 实名认证后自动获得接单权限
  - 用户完成实名认证后，系统自动将 `can_accept_task` 字段设置为可接单
  - 无需额外申请或管理员审核
  
- 跑腿员等级
  - 根据完成率、好评率、响应速度自动评定
  - 等级：新手、普通、优秀、金牌
  - 等级标识显示在用户信息中

#### 2.4.6 并发接单控制
- **问题场景**：多个用户同时点击接单按钮，可能导致一个任务被多人接单（类似超卖问题）
- **解决方案**：
  - **数据库层面**：使用乐观锁机制（版本号字段 `version`）
    - 接单时检查任务状态是否为"待接单"
    - 使用 `UPDATE ... WHERE status='待接单' AND version=#{version}` 确保原子性
    - 如果更新失败（版本号不匹配），说明已被其他用户接单，返回接单失败提示
  - **应用层面**：
    - 接单前再次检查任务状态
    - 使用分布式锁（Redis）防止并发接单（可选，高并发场景）
    - 接单成功后立即更新任务状态为"已接单"，防止重复接单
  - **用户体验**：
    - 接单按钮点击后立即禁用，防止重复点击
    - 接单失败时提示"该任务已被其他用户接单"
    - 实时更新任务状态，已接单的任务不再显示接单按钮

### 2.5 消息通知模块

#### 2.5.1 私信功能
- **私信会话管理**
  - 自动创建会话：认领申请、订单创建、任务接单时自动创建私信会话
  - 会话列表：显示所有私信会话，按最新消息时间排序
  - 会话详情：显示会话中的所有消息记录
  - 消息发送：支持文字、图片消息
  - 消息已读状态：显示消息是否已读
  
- **私信应用场景**
  - **失物认领**：认领申请后，双方通过私信协商交接方式、时间、地点
  - **闲置交易**：买家咨询商品、确认交易细节、约定交易时间地点
  - **跑腿服务**：接单后双方沟通任务细节、更新任务进度、确认完成情况
  - **通用沟通**：用户之间可以主动发起私信进行沟通

#### 2.5.2 系统消息通知
- **系统消息类型**
  - 审核结果通知：失物招领、商品、任务审核通过/拒绝通知
  - 订单状态变更通知：订单状态变化时通知相关用户
  - 认领状态通知：认领申请、确认、拒绝等操作通知
  - 任务状态通知：跑腿任务状态变更通知
  - 评论回复通知：收到评论或回复时通知
  - 系统公告：管理员发布的系统公告

#### 2.5.3 实时通知（WebSocket）
- **实时推送场景**
  - 新私信消息：收到新私信时实时推送
  - 系统消息：收到系统消息时实时推送
  - 订单状态变更：订单状态变化时实时通知
  - 认领状态变更：认领状态变化时实时通知
  - 任务状态变更：跑腿任务状态变化时实时通知
  - 评论回复：收到评论或回复时实时通知
  - 系统公告：管理员发布公告时推送给所有在线用户

#### 2.5.4 邮件通知
- 注册验证码：注册时发送邮箱验证码
- 密码重置：密码重置时发送重置链接
- 重要交易通知：重要订单状态变更时发送邮件通知（可选）
- 系统公告：重要系统公告发送邮件通知（可选）

### 2.6 信用评价系统

#### 2.6.1 信用积分
- 初始积分：100分
- 积分规则：
  - 完成交易：+5分
  - 获得好评：+3分
  - 获得差评：-5分
  - 违规行为：-10分
  - 认证通过：+10分

#### 2.6.2 信用等级
- 优秀（90-100分）：绿色标识
- 良好（80-89分）：蓝色标识
- 一般（70-79分）：黄色标识
- 较差（60-69分）：橙色标识
- 差（0-59分）：红色标识

### 2.7 数据统计模块（管理员）

#### 2.7.1 用户统计
- 用户总数
- 新增用户趋势
- 活跃用户数
- 用户分布（年级、专业）

#### 2.7.2 业务统计
- 失物招领发布量、认领率
- 闲置交易成交量、成交额
- 跑腿任务完成量、完成率
- 各分类数据统计

#### 2.7.3 数据可视化
- 使用ECharts展示各类图表
- 趋势分析
- 对比分析

## 三、数据库设计

### 3.1 用户表（user）

```sql
CREATE TABLE `user` (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '用户ID',
  `password` VARCHAR(255) NOT NULL COMMENT '密码（加密）',
  `nickname` VARCHAR(50) DEFAULT NULL COMMENT '昵称',
  `avatar` VARCHAR(255) DEFAULT NULL COMMENT '头像URL',
  `email` VARCHAR(100) NOT NULL COMMENT '邮箱（唯一，用于登录）',
  `gender` TINYINT(1) DEFAULT 0 COMMENT '性别：0-未知，1-男，2-女',
  `grade` VARCHAR(20) DEFAULT NULL COMMENT '年级',
  `major` VARCHAR(100) DEFAULT NULL COMMENT '专业',
  `real_name` VARCHAR(50) DEFAULT NULL COMMENT '真实姓名',
  `id_card` VARCHAR(18) DEFAULT NULL COMMENT '身份证号',
  `student_id` VARCHAR(50) DEFAULT NULL COMMENT '学号',
  `is_verified` TINYINT(1) DEFAULT 0 COMMENT '是否实名认证：0-未认证，1-已认证（已认证用户信息优先展示，认证后自动获得接单权限）',
  `can_accept_task` TINYINT(1) DEFAULT 0 COMMENT '是否可以接单跑腿：0-不可接单，1-可接单（实名认证后自动设置为可接单）',
  `credit_score` INT(11) DEFAULT 100 COMMENT '信用积分',
  `credit_level` VARCHAR(20) DEFAULT '一般' COMMENT '信用等级',
  `runner_level` VARCHAR(20) DEFAULT NULL COMMENT '跑腿员等级：新手、普通、优秀、金牌（仅可接单用户有）',
  `role` VARCHAR(20) DEFAULT 'USER' COMMENT '角色：USER-普通用户，ADMIN-管理员',
  `status` TINYINT(1) DEFAULT 1 COMMENT '状态：0-禁用，1-启用',
  `last_login_time` DATETIME DEFAULT NULL COMMENT '最后登录时间',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `delete_flag` TINYINT(1) DEFAULT 0 COMMENT '逻辑删除标志：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_email` (`email`),
  KEY `idx_credit_score` (`credit_score`),
  KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';
```

### 3.2 失物招领表（lost_found）

```sql
CREATE TABLE `lost_found` (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '失物ID',
  `user_id` BIGINT(20) NOT NULL COMMENT '发布者ID',
  `title` VARCHAR(200) NOT NULL COMMENT '物品名称',
  `category` VARCHAR(50) NOT NULL COMMENT '物品分类：证件类、电子产品、生活用品、书籍、其他',
  `description` TEXT COMMENT '物品描述',
  `lost_time` DATETIME NOT NULL COMMENT '丢失时间',
  `lost_location` VARCHAR(200) NOT NULL COMMENT '丢失地点',
  `contact` VARCHAR(100) DEFAULT NULL COMMENT '联系方式（可选，可通过私信联系）',
  `images` TEXT COMMENT '物品图片（JSON数组）',
  `reward` DECIMAL(10,2) DEFAULT 0.00 COMMENT '悬赏金额',
  `status` VARCHAR(20) DEFAULT '待认领' COMMENT '状态：待认领、认领中、已认领、已关闭',
  `version` INT(11) DEFAULT 0 COMMENT '版本号（乐观锁，用于防止并发认领）',
  `audit_status` VARCHAR(20) DEFAULT '待审核' COMMENT '审核状态：待审核、已通过、已拒绝',
  `audit_reason` VARCHAR(500) DEFAULT NULL COMMENT '审核原因',
  `view_count` INT(11) DEFAULT 0 COMMENT '浏览次数',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `delete_flag` TINYINT(1) DEFAULT 0 COMMENT '逻辑删除标志：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_category` (`category`),
  KEY `idx_status` (`status`),
  KEY `idx_create_time` (`create_time`),
  CONSTRAINT `fk_lost_found_user` FOREIGN KEY (`user_id`) REFERENCES `user` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='失物招领表';
```

### 3.3 失物认领表（lost_found_claim）

```sql
CREATE TABLE `lost_found_claim` (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '认领ID',
  `lost_found_id` BIGINT(20) NOT NULL COMMENT '失物ID',
  `claimer_id` BIGINT(20) NOT NULL COMMENT '认领人ID',
  `claim_description` TEXT COMMENT '认领描述',
  `claim_proof` TEXT COMMENT '认领证明（JSON数组）',
  `status` VARCHAR(20) DEFAULT '待确认' COMMENT '状态：待确认、已确认、已拒绝',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_lost_found_id` (`lost_found_id`),
  KEY `idx_claimer_id` (`claimer_id`),
  KEY `idx_status` (`status`),
  CONSTRAINT `fk_claim_lost_found` FOREIGN KEY (`lost_found_id`) REFERENCES `lost_found` (`id`),
  CONSTRAINT `fk_claim_user` FOREIGN KEY (`claimer_id`) REFERENCES `user` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='失物认领表';
```

### 3.4 闲置商品表（secondhand_goods）

```sql
CREATE TABLE `secondhand_goods` (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '商品ID',
  `user_id` BIGINT(20) NOT NULL COMMENT '卖家ID',
  `title` VARCHAR(200) NOT NULL COMMENT '商品名称',
  `category` VARCHAR(50) NOT NULL COMMENT '商品分类：电子产品、书籍、生活用品、服装、其他',
  `description` TEXT COMMENT '商品描述',
  `original_price` DECIMAL(10,2) NOT NULL COMMENT '原价',
  `current_price` DECIMAL(10,2) NOT NULL COMMENT '现价',
  `images` TEXT NOT NULL COMMENT '商品图片（JSON数组，至少1张）',
  `trade_method` VARCHAR(20) NOT NULL COMMENT '交易方式：面交、邮寄',
  `trade_location` VARCHAR(200) DEFAULT NULL COMMENT '交易地点（面交必填）',
  `contact` VARCHAR(100) DEFAULT NULL COMMENT '联系方式（可选，可通过私信联系）',
  `status` VARCHAR(20) DEFAULT '在售' COMMENT '状态：在售、已售出、已下架',
  `version` INT(11) DEFAULT 0 COMMENT '版本号（乐观锁，用于防止并发下单）',
  `audit_status` VARCHAR(20) DEFAULT '待审核' COMMENT '审核状态：待审核、已通过、已拒绝',
  `audit_reason` VARCHAR(500) DEFAULT NULL COMMENT '审核原因',
  `view_count` INT(11) DEFAULT 0 COMMENT '浏览次数',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `delete_flag` TINYINT(1) DEFAULT 0 COMMENT '逻辑删除标志：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_category` (`category`),
  KEY `idx_status` (`status`),
  KEY `idx_create_time` (`create_time`),
  CONSTRAINT `fk_goods_user` FOREIGN KEY (`user_id`) REFERENCES `user` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='闲置商品表';
```

### 3.5 订单表（order）

```sql
CREATE TABLE `order` (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '订单ID',
  `order_no` VARCHAR(50) NOT NULL COMMENT '订单号',
  `goods_id` BIGINT(20) NOT NULL COMMENT '商品ID',
  `buyer_id` BIGINT(20) NOT NULL COMMENT '买家ID',
  `seller_id` BIGINT(20) NOT NULL COMMENT '卖家ID',
  `goods_title` VARCHAR(200) NOT NULL COMMENT '商品名称（冗余字段）',
  `goods_images` TEXT COMMENT '商品图片（冗余字段）',
  `price` DECIMAL(10,2) NOT NULL COMMENT '成交价格',
  `trade_method` VARCHAR(20) NOT NULL COMMENT '交易方式：面交、邮寄',
  `trade_location` VARCHAR(200) DEFAULT NULL COMMENT '交易地点',
  `receiver_name` VARCHAR(50) DEFAULT NULL COMMENT '收货人姓名',
  `receiver_phone` VARCHAR(20) DEFAULT NULL COMMENT '收货人电话',
  `receiver_address` VARCHAR(500) DEFAULT NULL COMMENT '收货地址',
  `status` VARCHAR(20) DEFAULT '待付款' COMMENT '订单状态：待付款、待发货、待收货、待评价、已完成、已取消、退款中、已退款',
  `version` INT(11) DEFAULT 0 COMMENT '版本号（乐观锁，用于防止并发状态修改）',
  `pay_time` DATETIME DEFAULT NULL COMMENT '支付时间',
  `ship_time` DATETIME DEFAULT NULL COMMENT '发货时间',
  `receive_time` DATETIME DEFAULT NULL COMMENT '收货时间',
  `cancel_time` DATETIME DEFAULT NULL COMMENT '取消时间',
  `cancel_reason` VARCHAR(500) DEFAULT NULL COMMENT '取消原因',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `delete_flag` TINYINT(1) DEFAULT 0 COMMENT '逻辑删除标志：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_order_no` (`order_no`),
  KEY `idx_goods_id` (`goods_id`),
  KEY `idx_buyer_id` (`buyer_id`),
  KEY `idx_seller_id` (`seller_id`),
  KEY `idx_status` (`status`),
  KEY `idx_create_time` (`create_time`),
  CONSTRAINT `fk_order_goods` FOREIGN KEY (`goods_id`) REFERENCES `secondhand_goods` (`id`),
  CONSTRAINT `fk_order_buyer` FOREIGN KEY (`buyer_id`) REFERENCES `user` (`id`),
  CONSTRAINT `fk_order_seller` FOREIGN KEY (`seller_id`) REFERENCES `user` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='订单表';
```

### 3.6 评价表（evaluation）

```sql
CREATE TABLE `evaluation` (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '评价ID',
  `order_id` BIGINT(20) NOT NULL COMMENT '订单ID',
  `evaluator_id` BIGINT(20) NOT NULL COMMENT '评价人ID',
  `evaluated_id` BIGINT(20) NOT NULL COMMENT '被评价人ID',
  `role` VARCHAR(20) NOT NULL COMMENT '评价角色：BUYER-买家，SELLER-卖家',
  `description_score` TINYINT(1) DEFAULT 5 COMMENT '描述相符评分（1-5星）',
  `service_score` TINYINT(1) DEFAULT 5 COMMENT '服务态度评分（1-5星）',
  `logistics_score` TINYINT(1) DEFAULT 5 COMMENT '物流速度评分（1-5星）',
  `overall_score` TINYINT(1) DEFAULT 5 COMMENT '综合评分（1-5星）',
  `content` TEXT COMMENT '评价内容',
  `images` TEXT COMMENT '评价图片（JSON数组）',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `delete_flag` TINYINT(1) DEFAULT 0 COMMENT '逻辑删除标志：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  KEY `idx_order_id` (`order_id`),
  KEY `idx_evaluator_id` (`evaluator_id`),
  KEY `idx_evaluated_id` (`evaluated_id`),
  CONSTRAINT `fk_eval_order` FOREIGN KEY (`order_id`) REFERENCES `order` (`id`),
  CONSTRAINT `fk_eval_evaluator` FOREIGN KEY (`evaluator_id`) REFERENCES `user` (`id`),
  CONSTRAINT `fk_eval_evaluated` FOREIGN KEY (`evaluated_id`) REFERENCES `user` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='评价表';
```

### 3.7 跑腿任务表（errand_task）

```sql
CREATE TABLE `errand_task` (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '任务ID',
  `publisher_id` BIGINT(20) NOT NULL COMMENT '发布者ID',
  `runner_id` BIGINT(20) DEFAULT NULL COMMENT '接单用户ID',
  `task_type` VARCHAR(50) NOT NULL COMMENT '任务类型：代取快递、代买物品、代送物品、其他',
  `title` VARCHAR(200) NOT NULL COMMENT '任务标题',
  `description` TEXT NOT NULL COMMENT '任务描述',
  `start_location` VARCHAR(200) NOT NULL COMMENT '起始地点',
  `end_location` VARCHAR(200) NOT NULL COMMENT '目的地',
  `expected_time` DATETIME NOT NULL COMMENT '期望完成时间',
  `reward` DECIMAL(10,2) NOT NULL COMMENT '报酬金额',
  `contact` VARCHAR(100) DEFAULT NULL COMMENT '联系方式（可选，可通过私信联系）',
  `images` TEXT COMMENT '任务图片（JSON数组）',
  `status` VARCHAR(20) DEFAULT '待接单' COMMENT '任务状态：待接单、已接单、进行中、待确认、已完成、已取消、申诉中、申诉完成',
  `version` INT(11) DEFAULT 0 COMMENT '版本号（乐观锁，用于防止并发接单）',
  `audit_status` VARCHAR(20) DEFAULT '待审核' COMMENT '审核状态：待审核、已通过、已拒绝',
  `audit_reason` VARCHAR(500) DEFAULT NULL COMMENT '审核原因',
  `accept_time` DATETIME DEFAULT NULL COMMENT '接单时间',
  `start_time` DATETIME DEFAULT NULL COMMENT '开始时间',
  `complete_time` DATETIME DEFAULT NULL COMMENT '完成时间',
  `confirm_time` DATETIME DEFAULT NULL COMMENT '确认时间',
  `cancel_time` DATETIME DEFAULT NULL COMMENT '取消时间',
  `cancel_reason` VARCHAR(500) DEFAULT NULL COMMENT '取消原因',
  `view_count` INT(11) DEFAULT 0 COMMENT '浏览次数',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `delete_flag` TINYINT(1) DEFAULT 0 COMMENT '逻辑删除标志：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  KEY `idx_publisher_id` (`publisher_id`),
  KEY `idx_runner_id` (`runner_id`),
  KEY `idx_task_type` (`task_type`),
  KEY `idx_status` (`status`),
  KEY `idx_create_time` (`create_time`),
  CONSTRAINT `fk_errand_publisher` FOREIGN KEY (`publisher_id`) REFERENCES `user` (`id`),
  CONSTRAINT `fk_errand_runner` FOREIGN KEY (`runner_id`) REFERENCES `user` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='跑腿任务表';
```

### 3.8 跑腿订单表（errand_order）

```sql
CREATE TABLE `errand_order` (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '订单ID',
  `task_id` BIGINT(20) NOT NULL COMMENT '任务ID',
  `order_no` VARCHAR(50) NOT NULL COMMENT '订单号',
  `publisher_id` BIGINT(20) NOT NULL COMMENT '发布者ID',
  `runner_id` BIGINT(20) NOT NULL COMMENT '接单用户ID',
  `reward` DECIMAL(10,2) NOT NULL COMMENT '报酬金额',
  `status` VARCHAR(20) DEFAULT '待确认' COMMENT '订单状态：待确认、进行中、待确认完成、已完成、已取消、申诉中',
  `progress` TEXT COMMENT '任务进度描述',
  `pay_time` DATETIME DEFAULT NULL COMMENT '支付时间',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_order_no` (`order_no`),
  KEY `idx_task_id` (`task_id`),
  KEY `idx_publisher_id` (`publisher_id`),
  KEY `idx_runner_id` (`runner_id`),
  KEY `idx_status` (`status`),
  CONSTRAINT `fk_errand_order_task` FOREIGN KEY (`task_id`) REFERENCES `errand_task` (`id`),
  CONSTRAINT `fk_errand_order_publisher` FOREIGN KEY (`publisher_id`) REFERENCES `user` (`id`),
  CONSTRAINT `fk_errand_order_runner` FOREIGN KEY (`runner_id`) REFERENCES `user` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='跑腿订单表';
```

### 3.9 私信会话表（chat_session）

```sql
CREATE TABLE `chat_session` (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '会话ID',
  `user1_id` BIGINT(20) NOT NULL COMMENT '用户1 ID（较小的ID）',
  `user2_id` BIGINT(20) NOT NULL COMMENT '用户2 ID（较大的ID）',
  `related_type` VARCHAR(50) DEFAULT NULL COMMENT '关联类型：LOST_FOUND-失物招领，ORDER-订单，TASK-跑腿任务，NONE-无关联',
  `related_id` BIGINT(20) DEFAULT NULL COMMENT '关联ID',
  `last_message_id` BIGINT(20) DEFAULT NULL COMMENT '最后一条消息ID',
  `last_message_time` DATETIME DEFAULT NULL COMMENT '最后消息时间',
  `user1_unread_count` INT(11) DEFAULT 0 COMMENT '用户1未读消息数',
  `user2_unread_count` INT(11) DEFAULT 0 COMMENT '用户2未读消息数',
  `delete_flag` TINYINT(1) DEFAULT 0 COMMENT '逻辑删除标志：0-未删除，1-已删除',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_users_related` (`user1_id`, `user2_id`, `related_type`, `related_id`),
  KEY `idx_user1_id` (`user1_id`),
  KEY `idx_user2_id` (`user2_id`),
  KEY `idx_last_message_time` (`last_message_time`),
  CONSTRAINT `fk_session_user1` FOREIGN KEY (`user1_id`) REFERENCES `user` (`id`),
  CONSTRAINT `fk_session_user2` FOREIGN KEY (`user2_id`) REFERENCES `user` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='私信会话表';
```

### 3.10 私信消息表（chat_message）

```sql
CREATE TABLE `chat_message` (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '消息ID',
  `session_id` BIGINT(20) NOT NULL COMMENT '会话ID',
  `sender_id` BIGINT(20) NOT NULL COMMENT '发送者ID',
  `receiver_id` BIGINT(20) NOT NULL COMMENT '接收者ID',
  `content` TEXT NOT NULL COMMENT '消息内容',
  `message_type` VARCHAR(20) DEFAULT 'TEXT' COMMENT '消息类型：TEXT-文字，IMAGE-图片',
  `images` TEXT COMMENT '图片URL（JSON数组，仅图片消息）',
  `is_read` TINYINT(1) DEFAULT 0 COMMENT '是否已读：0-未读，1-已读',
  `read_time` DATETIME DEFAULT NULL COMMENT '阅读时间',
  `delete_flag` TINYINT(1) DEFAULT 0 COMMENT '逻辑删除标志：0-未删除，1-已删除',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_session_id` (`session_id`),
  KEY `idx_sender_id` (`sender_id`),
  KEY `idx_receiver_id` (`receiver_id`),
  KEY `idx_create_time` (`create_time`),
  CONSTRAINT `fk_message_session` FOREIGN KEY (`session_id`) REFERENCES `chat_session` (`id`),
  CONSTRAINT `fk_message_sender` FOREIGN KEY (`sender_id`) REFERENCES `user` (`id`),
  CONSTRAINT `fk_message_receiver` FOREIGN KEY (`receiver_id`) REFERENCES `user` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='私信消息表';
```

### 3.11 系统消息表（system_message）

```sql
CREATE TABLE `system_message` (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '消息ID',
  `receiver_id` BIGINT(20) NOT NULL COMMENT '接收者ID',
  `type` VARCHAR(20) NOT NULL COMMENT '消息类型：AUDIT-审核消息，ORDER-订单消息，CLAIM-认领消息，TASK-任务消息，COMMENT-评论消息，NOTICE-系统公告',
  `title` VARCHAR(200) NOT NULL COMMENT '消息标题',
  `content` TEXT NOT NULL COMMENT '消息内容',
  `related_id` BIGINT(20) DEFAULT NULL COMMENT '关联ID（订单ID、任务ID等）',
  `related_type` VARCHAR(50) DEFAULT NULL COMMENT '关联类型',
  `is_read` TINYINT(1) DEFAULT 0 COMMENT '是否已读：0-未读，1-已读',
  `read_time` DATETIME DEFAULT NULL COMMENT '阅读时间',
  `delete_flag` TINYINT(1) DEFAULT 0 COMMENT '逻辑删除标志：0-未删除，1-已删除',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_receiver_id` (`receiver_id`),
  KEY `idx_type` (`type`),
  KEY `idx_is_read` (`is_read`),
  KEY `idx_create_time` (`create_time`),
  CONSTRAINT `fk_system_message_receiver` FOREIGN KEY (`receiver_id`) REFERENCES `user` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='系统消息表';
```

### 3.12 评论表（comment）

```sql
CREATE TABLE `comment` (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '评论ID',
  `user_id` BIGINT(20) NOT NULL COMMENT '评论人ID',
  `target_type` VARCHAR(50) NOT NULL COMMENT '目标类型：LOST_FOUND-失物招领，GOODS-商品，TASK-跑腿任务',
  `target_id` BIGINT(20) NOT NULL COMMENT '目标ID',
  `parent_id` BIGINT(20) DEFAULT NULL COMMENT '父评论ID（回复评论时使用）',
  `content` TEXT NOT NULL COMMENT '评论内容',
  `like_count` INT(11) DEFAULT 0 COMMENT '点赞数',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `delete_flag` TINYINT(1) DEFAULT 0 COMMENT '逻辑删除标志：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  KEY `idx_target` (`target_type`, `target_id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_parent_id` (`parent_id`),
  KEY `idx_create_time` (`create_time`),
  CONSTRAINT `fk_comment_user` FOREIGN KEY (`user_id`) REFERENCES `user` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='评论表';
```

### 3.13 收藏表（favorite）

```sql
CREATE TABLE `favorite` (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '收藏ID',
  `user_id` BIGINT(20) NOT NULL COMMENT '用户ID',
  `target_type` VARCHAR(50) NOT NULL COMMENT '目标类型：LOST_FOUND-失物招领，GOODS-商品，TASK-跑腿任务',
  `target_id` BIGINT(20) NOT NULL COMMENT '目标ID',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_user_target` (`user_id`, `target_type`, `target_id`),
  KEY `idx_target` (`target_type`, `target_id`),
  CONSTRAINT `fk_favorite_user` FOREIGN KEY (`user_id`) REFERENCES `user` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='收藏表';
```

### 3.14 验证码表（verification_code）

```sql
CREATE TABLE `verification_code` (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '验证码ID',
  `type` VARCHAR(20) NOT NULL COMMENT '类型：REGISTER-注册，LOGIN-登录，RESET_PASSWORD-重置密码',
  `target` VARCHAR(100) NOT NULL COMMENT '目标（邮箱）',
  `code` VARCHAR(10) NOT NULL COMMENT '验证码',
  `expire_time` DATETIME NOT NULL COMMENT '过期时间',
  `is_used` TINYINT(1) DEFAULT 0 COMMENT '是否已使用：0-未使用，1-已使用',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_target_type` (`target`, `type`),
  KEY `idx_expire_time` (`expire_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='验证码表';
```

### 3.15 系统配置表（system_config）

```sql
CREATE TABLE `system_config` (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '配置ID',
  `config_key` VARCHAR(100) NOT NULL COMMENT '配置键',
  `config_value` TEXT COMMENT '配置值',
  `config_desc` VARCHAR(500) DEFAULT NULL COMMENT '配置描述',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_config_key` (`config_key`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='系统配置表';
```

## 四、WebSocket实时消息通知设计

### 4.1 WebSocket连接管理

#### 4.1.1 连接建立
- 客户端连接时携带JWT Token进行认证
- 服务端验证Token，提取用户ID，建立WebSocket连接
- **连接标识管理**：
  - 每个连接生成唯一连接ID（SessionId）
  - 将连接ID与用户ID进行映射存储（使用Redis）
  - Redis存储结构：`ws:user:{userId}` -> Set<SessionId>（支持同一用户多设备）
  - Redis存储结构：`ws:session:{sessionId}` -> userId（反向映射，用于断开时清理）

#### 4.1.2 连接维护
- 心跳机制：客户端每30秒发送ping，服务端响应pong
- 连接断开检测：超过60秒未收到心跳，主动断开连接
- 重连机制：客户端自动重连，服务端支持断线重连
- **连接清理**：连接断开时，从Redis中移除对应的映射关系

#### 4.1.3 多用户多客户端隔离机制
- **用户隔离**：
  - 每个用户拥有独立的订阅通道：`/user/{userId}/queue/messages`
  - 消息推送时指定目标用户ID，确保消息只推送给对应用户
  - 使用STOMP的`/user`前缀实现用户级别的消息路由
  
- **多设备支持**：
  - 同一用户可以在多个设备（手机、电脑等）同时连接
  - 每个设备拥有独立的SessionId
  - 消息推送给用户时，会推送给该用户的所有在线设备
  - Redis存储结构支持一个用户对应多个SessionId
  
- **数据隔离保障**：
  - **连接认证**：连接建立时验证JWT Token，确保用户身份正确
  - **消息路由**：使用Spring的`SimpMessagingTemplate.convertAndSendToUser()`方法，确保消息只发送给指定用户
  - **连接映射**：维护用户ID与SessionId的双向映射，防止数据混乱
  - **消息验证**：推送消息前验证接收者用户ID，防止消息串发
  - **连接状态检查**：推送前检查目标用户是否在线，避免无效推送

#### 4.1.3 消息推送场景
- **新私信消息**：用户收到新私信时实时推送
- **系统消息通知**：审核结果、订单状态变更、认领状态变更、任务状态变更等系统消息实时推送
- **评论通知**：收到评论或回复时推送
- **系统公告**：管理员发布公告时推送给所有在线用户

### 4.2 消息格式设计

```json
{
  "type": "MESSAGE_TYPE",
  "data": {
    "messageId": 123,
    "title": "消息标题",
    "content": "消息内容",
    "relatedId": 456,
    "relatedType": "ORDER",
    "timestamp": "2024-01-01 12:00:00"
  }
}
```

**消息类型（type）：**
- `NEW_CHAT_MESSAGE`：新私信消息
- `SYSTEM_MESSAGE`：系统消息（审核、订单、认领、任务等状态变更）
- `NEW_COMMENT`：新评论
- `SYSTEM_NOTICE`：系统公告

### 4.3 实现方案

#### 4.3.1 后端实现
- 使用Spring WebSocket + STOMP协议
- **消息路由机制**：
  - 使用`SimpMessagingTemplate.convertAndSendToUser(userId, destination, payload)`
  - 确保消息只发送给指定用户，不会串到其他用户
  - 支持用户级别的消息路由：`/user/{userId}/queue/messages`
- **连接管理**：
  - 使用Redis存储用户连接映射：`ws:user:{userId}` -> Set<SessionId>
  - 使用Redis存储会话映射：`ws:session:{sessionId}` -> userId
  - 连接建立时：将SessionId添加到用户连接集合
  - 连接断开时：从用户连接集合中移除SessionId，清理映射关系
- **消息推送流程**：
  1. 业务触发消息推送（如新私信、订单状态变更等）
  2. 根据接收者用户ID，从Redis获取该用户的所有在线SessionId
  3. 使用`convertAndSendToUser()`方法推送消息到用户专属通道
  4. Spring自动将消息路由到该用户的所有在线设备
  5. 如果用户不在线，消息存入数据库，待用户上线后推送
- **并发安全**：
  - 使用Redis的Set数据结构，保证连接管理的线程安全
  - 连接操作使用Redis事务或Lua脚本保证原子性
  - 消息推送使用Spring的线程安全机制

#### 4.3.2 前端实现
- 使用SockJS + STOMP.js
- **连接管理**：
  - 连接建立时携带JWT Token进行认证
  - 订阅用户专属通道：`/user/queue/messages`（Spring自动转换为`/user/{userId}/queue/messages`）
  - 自动重连：连接断开时自动重连，保持连接稳定
  - 心跳检测：定期发送心跳包，保持连接活跃
- **消息处理**：
  - 根据消息类型（type字段）进行相应处理
  - 消息去重：根据messageId避免重复处理同一条消息
  - 消息队列：离线消息在用户上线后批量推送
- **多设备同步**：
  - 每个设备独立连接，独立接收消息
  - 消息已读状态需要同步到所有设备（通过API接口）
  - 避免同一消息在多个设备重复处理

## 五、系统角色说明

### 5.0 角色定义

系统包含以下角色：

1. **普通用户（USER）** - 基础用户角色（所有学生）
2. **管理员（ADMIN）** - 系统管理员

**用户状态说明：**
- **实名认证状态**（`is_verified`）：普通用户可以选择进行实名认证
  - 未认证：基础功能正常使用
  - 已认证：发布的信息优先展示、显示认证标识和信用等级，**自动获得接单权限**
- **跑腿接单权限**（`can_accept_task`）：实名认证后自动获得
  - 不可接单：未实名认证用户
  - 可接单：实名认证后自动设置为可接单，无需额外申请或审核

**角色权限矩阵：**

| 功能模块 | 普通用户（未认证） | 普通用户（已认证） | 普通用户（可接单） | 管理员 |
|---------|------------------|------------------|------------------|--------|
| 注册登录 | ✅ | ✅ | ✅ | ✅ |
| 发布失物招领 | ✅ | ✅（优先展示） | ✅ | ✅ |
| 发布闲置商品 | ✅ | ✅（优先展示） | ✅ | ✅ |
| 发布跑腿任务 | ✅ | ✅（优先展示） | ✅ | ✅ |
| 认领失物 | ✅ | ✅ | ✅ | ✅ |
| 购买商品 | ✅ | ✅ | ✅ | ✅ |
| 接单跑腿任务 | ❌ | ✅（实名认证后自动获得） | ✅ | ✅ |
| 评论收藏 | ✅ | ✅ | ✅ | ✅ |
| 私信沟通 | ✅ | ✅ | ✅ | ✅ |
| 信息审核 | ❌ | ❌ | ❌ | ✅ |
| 用户管理 | ❌ | ❌ | ❌ | ✅ |
| 数据统计 | ❌ | ❌ | ❌ | ✅ |
| 系统配置 | ❌ | ❌ | ❌ | ✅ |

### 5.1 权限控制实现

#### 5.1.1 角色常量定义

##### 5.1.1.1 后端角色常量
```java
package com.server.campushelpserver.enums;

/**
 * 用户角色枚举
 */
public enum UserRole {
    /**
     * 普通用户
     */
    USER("USER", "普通用户"),
    
    /**
     * 管理员
     */
    ADMIN("ADMIN", "管理员");
    
    private final String code;
    private final String desc;
    
    UserRole(String code, String desc) {
        this.code = code;
        this.desc = desc;
    }
    
    public String getCode() {
        return code;
    }
    
    public String getDesc() {
        return desc;
    }
    
    /**
     * 根据code获取角色
     */
    public static UserRole fromCode(String code) {
        for (UserRole role : values()) {
            if (role.code.equals(code)) {
                return role;
            }
        }
        return USER; // 默认返回普通用户
    }
}
```

##### 5.1.1.2 前端角色常量
```javascript
// src/utils/constants.js

/**
 * 用户角色常量
 */
export const USER_ROLE = {
  USER: 'USER',      // 普通用户
  ADMIN: 'ADMIN'    // 管理员
}

/**
 * 用户状态常量
 */
export const USER_STATUS = {
  NOT_VERIFIED: 0,   // 未实名认证
  VERIFIED: 1,      // 已实名认证
  CAN_ACCEPT_TASK: 1 // 可接单（与实名认证关联）
}

/**
 * 权限标识常量
 */
export const PERMISSION = {
  // 基础权限
  VIEW: 'view',                    // 查看
  PUBLISH: 'publish',              // 发布
  
  // 业务权限
  PUBLISH_LOST_FOUND: 'publish:lost_found',      // 发布失物招领
  PUBLISH_GOODS: 'publish:goods',                // 发布闲置商品
  PUBLISH_TASK: 'publish:task',                  // 发布跑腿任务
  ACCEPT_TASK: 'accept:task',                    // 接单跑腿任务
  CLAIM_LOST_FOUND: 'claim:lost_found',          // 认领失物
  BUY_GOODS: 'buy:goods',                        // 购买商品
  
  // 管理权限
  AUDIT: 'audit',                                // 审核
  MANAGE_USER: 'manage:user',                    // 用户管理
  VIEW_STATISTICS: 'view:statistics',            // 数据统计
  MANAGE_CONFIG: 'manage:config',                // 系统配置
  PUBLISH_NOTICE: 'publish:notice'               // 发布公告
}
```

#### 5.1.2 后端权限控制实现

##### 5.1.2.1 JWT Token中的角色信息
```java
// JWT Token Payload示例
{
  "userId": 123,
  "username": "user@example.com",
  "role": "USER",              // 角色：USER或ADMIN
  "isVerified": true,           // 是否实名认证
  "canAcceptTask": true,        // 是否可以接单
  "exp": 1704067200
}
```

##### 5.1.2.2 Spring Security权限配置
```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .authorizeHttpRequests(auth -> auth
                // 公开接口（无需认证）
                .requestMatchers("/api/auth/**", "/api/public/**").permitAll()
                
                // 管理员专用接口
                .requestMatchers("/api/admin/**").hasRole("ADMIN")
                
                // 需要认证的接口
                .requestMatchers("/api/**").authenticated()
                
                // 其他请求允许访问
                .anyRequest().permitAll()
            )
            .addFilterBefore(jwtAuthenticationFilter(), UsernamePasswordAuthenticationFilter.class)
            .csrf().disable();
        
        return http.build();
    }
}
```

##### 5.1.2.3 接口级别的权限控制
```java
@RestController
@RequestMapping("/api/admin")
@PreAuthorize("hasRole('ADMIN')")  // 类级别：所有接口都需要管理员权限
public class AdminController {
    
    @GetMapping("/users")
    @PreAuthorize("hasRole('ADMIN')")  // 方法级别：再次确认权限
    public Result<List<User>> getUserList() {
        // 管理员才能访问
        return Result.success(userService.list());
    }
}

@RestController
@RequestMapping("/api/task")
public class TaskController {
    
    @PostMapping("/accept/{taskId}")
    @PreAuthorize("hasRole('USER')")  // 需要用户角色
    public Result<Void> acceptTask(@PathVariable Long taskId) {
        // 检查是否可接单
        User currentUser = getCurrentUser();
        if (!currentUser.getCanAcceptTask()) {
            throw new BusinessException("您尚未完成实名认证，无法接单");
        }
        // 接单逻辑
        return Result.success();
    }
}
```

##### 5.1.2.4 业务层面的权限验证
```java
@Service
public class TaskService {
    
    /**
     * 接单权限验证
     */
    private void checkAcceptPermission(User user) {
        // 1. 检查角色
        if (!UserRole.USER.getCode().equals(user.getRole())) {
            throw new BusinessException("只有普通用户才能接单");
        }
        
        // 2. 检查接单权限
        if (!user.getCanAcceptTask()) {
            throw new BusinessException("您尚未完成实名认证，无法接单");
        }
        
        // 3. 检查实名认证状态
        if (!user.getIsVerified()) {
            throw new BusinessException("请先完成实名认证");
        }
    }
    
    /**
     * 审核权限验证
     */
    private void checkAuditPermission(User user) {
        if (!UserRole.ADMIN.getCode().equals(user.getRole())) {
            throw new BusinessException("只有管理员才能审核");
        }
    }
}
```

#### 5.1.3 前端权限控制实现

##### 5.1.3.1 用户信息存储（Pinia Store）
```javascript
// src/stores/user.js
import { defineStore } from 'pinia'
import { USER_ROLE, USER_STATUS } from '@/utils/constants'

export const useUserStore = defineStore('user', {
  state: () => ({
    userId: null,
    username: '',
    email: '',
    role: USER_ROLE.USER,        // 角色：USER或ADMIN
    isVerified: false,           // 是否实名认证
    canAcceptTask: false,        // 是否可以接单
    token: null
  }),
  
  getters: {
    // 是否为管理员
    isAdmin: (state) => state.role === USER_ROLE.ADMIN,
    
    // 是否为普通用户
    isUser: (state) => state.role === USER_ROLE.USER,
    
    // 是否可以接单
    canAcceptTask: (state) => state.canAcceptTask && state.isVerified,
    
    // 是否有权限
    hasPermission: (state) => (permission) => {
      // 管理员拥有所有权限
      if (state.role === USER_ROLE.ADMIN) {
        return true
      }
      
      // 普通用户权限判断
      switch (permission) {
        case 'accept:task':
          return state.canAcceptTask && state.isVerified
        case 'publish:lost_found':
        case 'publish:goods':
        case 'publish:task':
        case 'claim:lost_found':
        case 'buy:goods':
          return state.role === USER_ROLE.USER
        default:
          return false
      }
    }
  },
  
  actions: {
    // 设置用户信息
    setUserInfo(userInfo) {
      this.userId = userInfo.userId
      this.username = userInfo.username
      this.email = userInfo.email
      this.role = userInfo.role
      this.isVerified = userInfo.isVerified
      this.canAcceptTask = userInfo.canAcceptTask
    },
    
    // 清除用户信息
    clearUserInfo() {
      this.userId = null
      this.username = ''
      this.email = ''
      this.role = USER_ROLE.USER
      this.isVerified = false
      this.canAcceptTask = false
      this.token = null
    }
  }
})
```

##### 5.1.3.2 路由权限控制（路由守卫）
```javascript
// src/router/guard.js
import { useUserStore } from '@/stores/user'
import { USER_ROLE } from '@/utils/constants'

/**
 * 路由权限守卫
 */
export function setupRouterGuard(router) {
  router.beforeEach((to, from, next) => {
    const userStore = useUserStore()
    
    // 1. 检查是否需要登录
    if (to.meta.requiresAuth && !userStore.token) {
      next({
        path: '/login',
        query: { redirect: to.fullPath }
      })
      return
    }
    
    // 2. 检查角色权限
    if (to.meta.roles && to.meta.roles.length > 0) {
      const hasRole = to.meta.roles.includes(userStore.role)
      if (!hasRole) {
        // 无权限，跳转到403页面或首页
        next({ path: '/403' })
        return
      }
    }
    
    // 3. 检查具体权限
    if (to.meta.permission) {
      const hasPermission = userStore.hasPermission(to.meta.permission)
      if (!hasPermission) {
        ElMessage.error('您没有权限访问该页面')
        next({ path: '/403' })
        return
      }
    }
    
    next()
  })
}
```

##### 5.1.3.3 路由配置（带权限标识）
```javascript
// src/router/index.js
import { USER_ROLE, PERMISSION } from '@/utils/constants'

const routes = [
  {
    path: '/',
    component: Layout,
    redirect: '/home',
    children: [
      {
        path: 'home',
        name: 'Home',
        component: () => import('@/views/Home.vue'),
        meta: {
          requiresAuth: true,
          title: '首页'
        }
      }
    ]
  },
  
  // 普通用户和管理员都可以访问
  {
    path: '/lost-found',
    component: Layout,
    meta: {
      requiresAuth: true,
      title: '失物招领'
    },
    children: [
      {
        path: 'list',
        name: 'LostFoundList',
        component: () => import('@/views/lost-found/List.vue')
      },
      {
        path: 'publish',
        name: 'LostFoundPublish',
        component: () => import('@/views/lost-found/Publish.vue'),
        meta: {
          permission: PERMISSION.PUBLISH_LOST_FOUND
        }
      }
    ]
  },
  
  // 需要接单权限的页面
  {
    path: '/task',
    component: Layout,
    meta: {
      requiresAuth: true,
      title: '跑腿服务'
    },
    children: [
      {
        path: 'list',
        name: 'TaskList',
        component: () => import('@/views/task/List.vue')
      },
      {
        path: 'accept/:id',
        name: 'TaskAccept',
        component: () => import('@/views/task/Accept.vue'),
        meta: {
          permission: PERMISSION.ACCEPT_TASK
        }
      }
    ]
  },
  
  // 管理员专用页面
  {
    path: '/admin',
    component: Layout,
    meta: {
      requiresAuth: true,
      roles: [USER_ROLE.ADMIN],  // 只有管理员可以访问
      title: '管理后台'
    },
    children: [
      {
        path: 'dashboard',
        name: 'AdminDashboard',
        component: () => import('@/views/admin/Dashboard.vue')
      },
      {
        path: 'users',
        name: 'AdminUsers',
        component: () => import('@/views/admin/Users.vue'),
        meta: {
          permission: PERMISSION.MANAGE_USER
        }
      },
      {
        path: 'audit',
        name: 'AdminAudit',
        component: () => import('@/views/admin/Audit.vue'),
        meta: {
          permission: PERMISSION.AUDIT
        }
      },
      {
        path: 'statistics',
        name: 'AdminStatistics',
        component: () => import('@/views/admin/Statistics.vue'),
        meta: {
          permission: PERMISSION.VIEW_STATISTICS
        }
      }
    ]
  }
]
```

##### 5.1.3.4 菜单显示控制
```vue
<!-- src/components/Layout/Sidebar.vue -->
<template>
  <el-menu>
    <!-- 所有用户都可以看到的菜单 -->
    <el-menu-item index="/home">
      <el-icon><HomeFilled /></el-icon>
      <span>首页</span>
    </el-menu-item>
    
    <el-menu-item index="/lost-found/list">
      <el-icon><Search /></el-icon>
      <span>失物招领</span>
    </el-menu-item>
    
    <el-menu-item index="/goods/list">
      <el-icon><ShoppingBag /></el-icon>
      <span>闲置交易</span>
    </el-menu-item>
    
    <el-menu-item index="/task/list">
      <el-icon><Truck /></el-icon>
      <span>跑腿服务</span>
    </el-menu-item>
    
    <!-- 需要接单权限的菜单 -->
    <el-menu-item 
      v-if="userStore.hasPermission('accept:task')"
      index="/task/my-accepted"
    >
      <el-icon><List /></el-icon>
      <span>我的接单</span>
    </el-menu-item>
    
    <!-- 管理员专用菜单 -->
    <el-submenu v-if="userStore.isAdmin" index="/admin">
      <template #title>
        <el-icon><Setting /></el-icon>
        <span>管理后台</span>
      </template>
      <el-menu-item index="/admin/dashboard">数据概览</el-menu-item>
      <el-menu-item index="/admin/users">用户管理</el-menu-item>
      <el-menu-item index="/admin/audit">信息审核</el-menu-item>
      <el-menu-item index="/admin/statistics">数据统计</el-menu-item>
    </el-submenu>
  </el-menu>
</template>

<script setup>
import { useUserStore } from '@/stores/user'

const userStore = useUserStore()
</script>
```

##### 5.1.3.5 按钮权限控制（指令或组件）
```javascript
// src/utils/permission.js

/**
 * 权限指令
 */
export const permissionDirective = {
  mounted(el, binding) {
    const { value } = binding
    const userStore = useUserStore()
    
    if (value) {
      const hasPermission = userStore.hasPermission(value)
      if (!hasPermission) {
        // 无权限，隐藏元素
        el.style.display = 'none'
        // 或者移除元素
        // el.parentNode && el.parentNode.removeChild(el)
      }
    }
  }
}

// 在main.js中注册
import { permissionDirective } from '@/utils/permission'
app.directive('permission', permissionDirective)
```

```vue
<!-- 使用权限指令 -->
<template>
  <div>
    <!-- 普通用户和管理员都可以看到 -->
    <el-button @click="publishLostFound">发布失物</el-button>
    
    <!-- 只有可接单用户可以看到 -->
    <el-button 
      v-permission="'accept:task'"
      @click="acceptTask"
    >
      接单
    </el-button>
    
    <!-- 只有管理员可以看到 -->
    <el-button 
      v-if="userStore.isAdmin"
      @click="audit"
    >
      审核
    </el-button>
  </div>
</template>
```

#### 5.1.4 不同角色的页面显示规则

##### 5.1.4.1 普通用户（未认证）页面
- **可访问页面**：
  - 首页
  - 失物招领列表、详情
  - 闲置商品列表、详情
  - 跑腿任务列表、详情
  - 个人中心
  - 发布失物招领
  - 发布闲置商品
  - 发布跑腿任务
  - 认领失物
  - 购买商品
  - 私信列表、聊天
  - 系统消息列表
  
- **不可访问页面**：
  - 接单相关页面（接单按钮隐藏）
  - 管理后台所有页面
  - 我的接单页面

##### 5.1.4.2 普通用户（已认证/可接单）页面
- **可访问页面**（在未认证用户基础上增加）：
  - 我的接单页面
  - 接单详情页面
  - 跑腿统计页面
  
- **页面显示差异**：
  - 失物招领/商品/任务列表：已认证用户发布的信息优先展示
  - 用户信息：显示认证标识和信用等级
  - 跑腿任务详情：显示"接单"按钮

##### 5.1.4.3 管理员页面
- **可访问页面**（在普通用户基础上增加）：
  - 管理后台首页（数据概览）
  - 用户管理页面
  - 信息审核页面
  - 数据统计页面
  - 系统配置页面
  - 系统公告发布页面
  
- **页面显示差异**：
  - 导航栏：显示"管理后台"菜单
  - 失物招领/商品/任务详情：显示"审核"按钮
  - 用户列表：显示"禁用/启用"、"查看详情"按钮

#### 5.1.5 权限控制最佳实践

##### 5.1.5.1 前后端双重验证
- **前端验证**：用户体验优化，提前隐藏无权限功能
- **后端验证**：安全保证，防止绕过前端直接调用接口
- **原则**：前端验证可省略，后端验证必须实现

##### 5.1.5.2 权限缓存策略
- **用户信息缓存**：登录后缓存用户角色和权限信息
- **权限更新**：角色或权限变更后，清除缓存，重新获取
- **Token刷新**：Token刷新时，同步更新权限信息

##### 5.1.5.3 权限错误处理
- **403错误**：无权限访问，跳转到403页面或首页
- **401错误**：未登录或Token过期，跳转到登录页
- **错误提示**：使用统一的错误提示信息（参考7.5错误提示规范）

##### 5.1.5.4 权限测试要点
- **角色切换测试**：测试不同角色登录后的页面显示
- **权限边界测试**：测试无权限操作的错误处理
- **接口权限测试**：测试直接调用接口的权限验证
- **状态变更测试**：测试实名认证后权限自动更新

## 六、开发计划（按开发顺序）

### 开发顺序说明

**核心原则：**
1. 先基础后功能：先搭建基础框架，再实现业务功能
2. 先通用后特殊：先实现通用功能，再实现特殊功能
3. 先简单后复杂：先实现简单功能，再实现复杂功能
4. 先用户后管理：先实现用户端功能，再实现管理端功能
5. 先单体后集成：先实现独立模块，再集成消息通知等跨模块功能

**开发依赖关系：**
- 用户管理 → 所有业务模块（必须先有用户才能发布信息）
- 业务模块 → 消息通知（业务操作触发消息）
- 业务模块 → 评论收藏（业务内容需要评论功能）
- 业务模块 → 信用评价（业务完成后需要评价）
- 所有模块 → 数据统计（需要数据积累）

### 6.1 第一阶段：基础框架搭建 ⭐ 优先级：最高

**开发目标：** 搭建项目基础架构，实现用户注册登录，为后续开发奠定基础

**涉及角色：** 所有角色

#### 6.1.1 后端开发（必须先完成）
1. ✅ 完善项目基础配置（数据库、Redis、MyBatis-Plus等）
2. ✅ 实现统一响应格式（Result类）
3. ✅ 实现统一异常处理（GlobalExceptionHandler）
4. ✅ 实现JWT认证机制（JwtConfig、JwtAuthenticationFilter）
5. ✅ 配置Swagger API文档（OpenApiConfig）
6. ✅ 实现用户注册接口（邮箱注册、验证码验证）
7. ✅ 实现用户登录接口（邮箱登录、JWT Token生成）
8. ✅ 实现验证码发送接口（邮件验证码）
9. ✅ 实现文件上传接口（图片上传基础功能）

#### 6.1.2 前端开发（与后端并行）
1. ✅ 完善项目基础配置（Vite、路由、状态管理等）
2. ✅ 实现登录注册页面（邮箱注册、邮箱登录）
3. ✅ 实现路由守卫（登录状态检查）
4. ✅ 实现HTTP请求封装（Axios拦截器、Token管理）
5. ✅ 实现用户状态管理（Pinia Store）
6. ✅ 搭建基础布局组件（Header、Sidebar、Main等）

**开发顺序：**
1. 后端基础配置 → 2. 前端基础配置 → 3. 后端用户注册登录 → 4. 前端登录注册页面 → 5. 前后端联调

---

### 6.2 第二阶段：用户管理模块 ⭐ 优先级：高

**开发目标：** 完善用户信息管理，实现用户认证功能

**涉及角色：** 普通用户

#### 6.2.1 后端开发
1. ✅ 实现用户信息查询接口（获取当前用户信息）
2. ✅ 实现用户信息更新接口（修改昵称、头像、性别等）
3. ✅ 实现用户头像上传接口
4. ✅ 实现实名认证接口（提交认证信息、管理员审核）
5. ✅ 实现用户列表查询接口（管理员用）

#### 6.2.2 前端开发
1. ✅ 实现个人中心页面（用户信息展示）
2. ✅ 实现用户信息编辑页面（修改个人信息）
3. ✅ 实现头像上传功能（图片上传、预览）
4. ✅ 实现实名认证页面（提交认证信息）

**开发顺序：**
1. 后端用户信息接口 → 2. 前端个人中心页面 → 3. 后端实名认证接口 → 4. 前端认证页面

---

### 6.3 第三阶段：失物招领模块 ⭐ 优先级：高

**开发目标：** 实现失物招领核心功能，包括发布、浏览、认领

**涉及角色：** 普通用户、管理员

#### 6.3.1 后端开发
1. ✅ 实现失物发布接口（创建失物信息）
2. ✅ 实现失物列表查询接口（分页、筛选、排序）
3. ✅ 实现失物详情接口（查看详细信息）
4. ✅ 实现失物搜索接口（关键词搜索、高级搜索）
5. ✅ 实现认领功能接口（提交认领、确认认领、拒绝认领）
6. ✅ 实现失物状态管理接口（更新状态）
7. ✅ 实现审核功能接口（管理员审核）

#### 6.3.2 前端开发
1. ✅ 实现失物发布页面（表单、图片上传）
2. ✅ 实现失物列表页面（列表展示、筛选、分页）
3. ✅ 实现失物详情页面（详情展示、认领按钮）
4. ✅ 实现失物搜索功能（搜索框、高级搜索）
5. ✅ 实现认领功能页面（认领表单、证明上传）
6. ✅ 实现图片上传预览（多图上传、预览）

**开发顺序：**
1. 后端失物发布接口 → 2. 前端发布页面 → 3. 后端列表查询接口 → 4. 前端列表页面 → 5. 后端详情接口 → 6. 前端详情页面 → 7. 后端认领接口 → 8. 前端认领页面 → 9. 后端审核接口（管理员功能）

---

### 6.4 第四阶段：闲置交易模块 ⭐ 优先级：高

**开发目标：** 实现闲置商品交易功能，包括发布、浏览、下单、评价

**涉及角色：** 普通用户、管理员

#### 6.4.1 后端开发
1. ✅ 实现商品发布接口（创建商品信息）
2. ✅ 实现商品列表查询接口（分页、筛选、排序）
3. ✅ 实现商品详情接口（查看详细信息）
4. ✅ 实现商品搜索接口（关键词搜索、价格筛选）
5. ✅ 实现订单创建接口（创建订单）
6. ✅ 实现订单状态管理接口（支付、发货、收货、取消等）
7. ✅ 实现支付接口（模拟支付，不调用外部接口）
8. ✅ 实现评价功能接口（发布评价、查看评价）

#### 6.4.2 前端开发
1. ✅ 实现商品发布页面（表单、图片上传）
2. ✅ 实现商品列表页面（列表展示、筛选、排序）
3. ✅ 实现商品详情页面（详情展示、下单按钮）
4. ✅ 实现商品搜索功能（搜索框、价格筛选）
5. ✅ 实现订单管理页面（订单列表、订单详情、状态操作）
6. ✅ 实现评价功能页面（评价表单、评价展示）

**开发顺序：**
1. 后端商品发布接口 → 2. 前端发布页面 → 3. 后端列表查询接口 → 4. 前端列表页面 → 5. 后端详情接口 → 6. 前端详情页面 → 7. 后端订单接口 → 8. 前端订单页面 → 9. 后端评价接口 → 10. 前端评价页面

---

### 6.5 第五阶段：跑腿服务模块 ⭐ 优先级：高

**开发目标：** 实现跑腿任务功能，包括发布、接单、状态流转

**涉及角色：** 普通用户、管理员

#### 6.5.1 后端开发
1. ✅ 实现跑腿任务发布接口（创建任务）
2. ✅ 实现跑腿任务列表查询接口（分页、筛选、排序）
3. ✅ 实现跑腿任务详情接口（查看详细信息）
4. ✅ 实现跑腿任务搜索接口（关键词搜索、地点搜索）
5. ✅ 实现接单功能接口（用户接单）
6. ✅ 实现任务状态流转接口（状态变更、时间记录）
7. ✅ 实现任务进度更新接口（接单用户更新进度）
8. ✅ 实现申诉功能接口（提交申诉、处理申诉）
9. ✅ 实现跑腿接单申请接口（申请接单权限、管理员审核）

#### 6.5.2 前端开发
1. ✅ 实现跑腿任务发布页面（表单、图片上传）
2. ✅ 实现跑腿任务列表页面（列表展示、筛选）
3. ✅ 实现跑腿任务详情页面（详情展示、接单按钮）
4. ✅ 实现接单功能页面（接单确认，包含防重复点击、实时状态更新）
5. ✅ 实现任务进度管理页面（进度更新、状态查看）
6. ✅ 实现申诉功能页面（申诉表单）

**开发顺序：**
1. 后端任务发布接口 → 2. 前端发布页面 → 3. 后端列表查询接口 → 4. 前端列表页面 → 5. 后端接单接口（含并发控制） → 6. 前端接单页面（含防重复点击） → 7. 后端状态流转接口 → 8. 前端进度管理页面

---

### 6.6 第六阶段：消息通知模块 ⭐ 优先级：中

**开发目标：** 实现私信功能和系统消息通知，支持实时通信

**涉及角色：** 所有角色

**依赖关系：** 必须在失物招领、闲置交易、跑腿服务模块完成后开发（因为私信会话需要关联这些业务）

#### 6.6.1 后端开发
1. ✅ 实现邮件发送功能（注册验证码、密码重置等基础邮件）
2. ✅ 实现私信会话管理接口（创建会话、查询会话列表）
3. ✅ 实现私信消息发送接口（发送文字、图片消息）
4. ✅ 实现私信消息查询接口（查询会话消息历史）
5. ✅ 实现系统消息接口（创建系统消息、查询系统消息）
6. ✅ 实现消息已读标记接口（标记消息已读）
7. ✅ 实现WebSocket连接管理（连接建立、维护、断开、用户连接映射）
8. ✅ 实现消息推送功能（私信消息推送、系统消息推送，确保用户隔离）
9. ✅ 实现多用户多客户端隔离机制（用户连接映射、消息路由、数据隔离）
10. ✅ 实现消息模板管理（系统消息模板）

#### 6.6.2 前端开发
1. ✅ 实现邮件通知功能（注册验证码接收）
2. ✅ 实现私信会话列表页面（会话列表展示）
3. ✅ 实现私信聊天页面（消息发送、接收、实时更新）
4. ✅ 实现系统消息列表页面（系统消息展示）
5. ✅ 实现WebSocket连接（连接建立、心跳、重连、用户专属通道订阅）
6. ✅ 实现消息通知提示（新消息提示、未读数显示）
7. ✅ 实现消息实时更新（WebSocket消息接收处理、消息去重）
8. ✅ 实现多设备消息同步（消息已读状态同步）

**开发顺序：**
1. 后端邮件发送功能 → 2. 后端私信会话接口 → 3. 前端私信会话列表 → 4. 后端私信消息接口 → 5. 前端私信聊天页面 → 6. 后端WebSocket → 7. 前端WebSocket连接 → 8. 后端系统消息接口 → 9. 前端系统消息页面 → 10. 前后端联调实时推送

---

### 6.7 第七阶段：评论和收藏模块 ⭐ 优先级：中

**开发目标：** 实现评论和收藏功能，增强用户互动

**涉及角色：** 所有用户角色

**依赖关系：** 必须在失物招领、闲置交易、跑腿服务模块完成后开发（评论需要关联这些业务）

#### 6.7.1 后端开发
1. ✅ 实现评论发布接口（发布评论）
2. ✅ 实现评论列表查询接口（查询评论列表）
3. ✅ 实现评论回复接口（回复评论）
4. ✅ 实现评论点赞接口（点赞/取消点赞）
5. ✅ 实现收藏功能接口（收藏/取消收藏）
6. ✅ 实现收藏列表查询接口（查询用户收藏）

#### 6.7.2 前端开发
1. ✅ 实现评论组件（评论输入、评论展示）
2. ✅ 实现评论列表展示（评论列表、回复嵌套）
3. ✅ 实现评论回复功能（回复按钮、回复表单）
4. ✅ 实现收藏功能（收藏按钮、收藏状态）

**开发顺序：**
1. 后端评论接口 → 2. 前端评论组件 → 3. 后端收藏接口 → 4. 前端收藏功能 → 5. 集成到各业务模块详情页

---

### 6.8 第八阶段：信用评价系统 ⭐ 优先级：中

**开发目标：** 实现信用积分和等级评定系统

**涉及角色：** 所有用户角色

**依赖关系：** 必须在交易模块和评价模块完成后开发（需要交易和评价数据来计算信用）

#### 6.8.1 后端开发
1. ✅ 实现信用积分计算逻辑（交易完成、评价、认证等触发积分变化）
2. ✅ 实现信用等级评定（根据积分自动评定等级）
3. ✅ 实现信用记录查询接口（查询积分变化记录）
4. ✅ 实现信用统计接口（用户信用统计）

#### 6.8.2 前端开发
1. ✅ 实现信用积分展示（个人中心显示积分和等级）
2. ✅ 实现信用记录页面（积分变化记录列表）
3. ✅ 实现信用等级标识（用户信息中显示等级标识）

**开发顺序：**
1. 后端信用积分计算逻辑 → 2. 后端信用等级评定 → 3. 前端信用展示 → 4. 后端信用记录接口 → 5. 前端信用记录页面

---

### 6.9 第九阶段：数据统计模块（管理员） ⭐ 优先级：低

**开发目标：** 实现管理员数据统计功能

**涉及角色：** 管理员

**依赖关系：** 必须在所有业务模块完成后开发（需要数据积累）

#### 6.9.1 后端开发
1. ✅ 实现用户统计接口（用户总数、新增趋势、活跃用户）
2. ✅ 实现业务统计接口（失物招领、交易、跑腿任务统计）
3. ✅ 实现数据导出功能（Excel导出）
4. ✅ 实现图表数据接口（ECharts所需数据格式）

#### 6.9.2 前端开发
1. ✅ 实现数据统计页面（统计概览）
2. ✅ 实现图表展示（ECharts图表：折线图、柱状图、饼图等）
3. ✅ 实现数据导出功能（导出Excel）

**开发顺序：**
1. 后端用户统计接口 → 2. 后端业务统计接口 → 3. 前端统计页面 → 4. 后端图表数据接口 → 5. 前端图表展示 → 6. 数据导出功能

---

### 6.10 第十阶段：系统优化和测试 ⭐ 优先级：中

**开发目标：** 系统性能优化、安全加固、全面测试

**涉及角色：** 所有角色

#### 6.10.1 后端优化
1. ✅ 性能优化（数据库索引优化、Redis缓存优化、查询优化）
2. ✅ 接口性能测试（压力测试、响应时间测试）
3. ✅ 安全加固（SQL注入防护、XSS防护、接口权限检查）
4. ✅ 代码优化和重构（代码规范、消除冗余）

#### 6.10.2 前端优化
1. ✅ 页面性能优化（懒加载、代码分割、图片优化）
2. ✅ 用户体验优化（加载动画、错误提示、操作反馈）
3. ✅ 兼容性测试（浏览器兼容性测试）
4. ✅ 代码优化和重构（组件复用、代码规范）

#### 6.10.3 系统测试
1. ✅ 功能测试（各模块功能完整性测试）
2. ✅ 性能测试（系统负载测试、并发测试）
3. ✅ 安全测试（安全漏洞扫描、渗透测试）
4. ✅ 用户验收测试（真实用户场景测试）

**开发顺序：**
1. 功能测试 → 2. 性能优化 → 3. 安全加固 → 4. 用户体验优化 → 5. 全面测试 → 6. 修复问题 → 7. 用户验收

---

## 七、开发优先级总结

### 优先级说明
- ⭐⭐⭐ **最高优先级**：基础框架、用户管理、核心业务模块（失物招领、闲置交易、跑腿服务）
- ⭐⭐ **高优先级**：消息通知、评论收藏、信用评价
- ⭐ **中优先级**：数据统计、系统优化

### 开发时间线建议

**第一阶段（基础）** → **第二阶段（用户）** → **第三阶段（失物招领）** → **第四阶段（闲置交易）** → **第五阶段（跑腿服务）** → **第六阶段（消息通知）** → **第七阶段（评论收藏）** → **第八阶段（信用评价）** → **第九阶段（数据统计）** → **第十阶段（优化测试）**

### 关键里程碑

1. **里程碑1**：完成第一阶段和第二阶段（用户可以注册登录并管理个人信息）
2. **里程碑2**：完成第三、四、五阶段（核心业务功能全部实现）
3. **里程碑3**：完成第六阶段（实时消息通知功能）
4. **里程碑4**：完成第七、八阶段（用户互动和信用体系）
5. **里程碑5**：完成第九、十阶段（管理功能和系统优化）

#### 5.1.1 后端开发
- [x] 完善项目基础配置
- [x] 实现用户注册登录功能
- [x] 实现JWT认证机制
- [x] 实现基础CRUD功能
- [x] 配置Swagger API文档
- [x] 实现统一异常处理
- [x] 实现统一响应格式

#### 5.1.2 前端开发
- [x] 完善项目基础配置
- [x] 实现登录注册页面
- [x] 实现路由守卫
- [x] 实现HTTP请求封装
- [x] 实现用户状态管理
- [x] 搭建基础布局组件

### 5.2 第二阶段：用户管理模块

#### 5.2.1 后端开发
- [x] 实现用户信息管理接口
- [x] 实现用户认证接口
- [x] 实现验证码发送接口
- [x] 实现文件上传接口
- [x] 实现用户头像上传
- [x] 实现实名认证接口（提交认证信息、管理员审核）

#### 5.2.2 前端开发
- [x] 实现个人中心页面
- [x] 实现用户信息编辑页面
- [x] 实现头像上传功能
- [x] 实现实名认证页面（提交认证信息）

### 5.3 第三阶段：失物招领模块

#### 5.3.1 后端开发
- [ ] 实现失物发布接口
- [ ] 实现失物列表查询接口
- [ ] 实现失物详情接口
- [ ] 实现失物搜索接口
- [ ] 实现认领功能接口
- [ ] 实现失物状态管理接口
- [ ] 实现审核功能接口

#### 5.3.2 前端开发
- [ ] 实现失物发布页面
- [ ] 实现失物列表页面
- [ ] 实现失物详情页面
- [ ] 实现失物搜索功能
- [ ] 实现认领功能页面
- [ ] 实现图片上传预览

### 5.4 第四阶段：闲置交易模块

#### 5.4.1 后端开发
- [ ] 实现商品发布接口
- [ ] 实现商品列表查询接口
- [ ] 实现商品详情接口
- [ ] 实现商品搜索接口
- [ ] 实现订单创建接口
- [ ] 实现订单状态管理接口
- [ ] 实现支付接口（模拟）
- [ ] 实现评价功能接口

#### 5.4.2 前端开发
- [ ] 实现商品发布页面
- [ ] 实现商品列表页面
- [ ] 实现商品详情页面
- [ ] 实现商品搜索功能
- [ ] 实现订单管理页面
- [ ] 实现评价功能页面

### 5.5 第五阶段：跑腿服务模块

#### 5.5.1 后端开发
- [ ] 实现跑腿任务发布接口
- [ ] 实现跑腿任务列表查询接口
- [ ] 实现跑腿任务详情接口
- [ ] 实现跑腿任务搜索接口
- [ ] 实现接单功能接口
- [ ] 实现任务状态流转接口
- [ ] 实现任务进度更新接口
- [ ] 实现申诉功能接口

#### 5.5.2 前端开发
- [ ] 实现跑腿任务发布页面
- [ ] 实现跑腿任务列表页面
- [ ] 实现跑腿任务详情页面
- [ ] 实现接单功能页面
- [ ] 实现任务进度管理页面
- [ ] 实现申诉功能页面

### 5.6 第六阶段：消息通知模块

#### 5.6.1 后端开发
- [ ] 实现WebSocket连接管理
- [ ] 实现私信会话管理接口
- [ ] 实现私信消息发送接口
- [ ] 实现私信消息查询接口
- [ ] 实现系统消息接口
- [ ] 实现消息推送功能
- [ ] 实现消息已读标记接口
- [ ] 实现邮件发送功能
- [ ] 实现消息模板管理

#### 5.6.2 前端开发
- [ ] 实现WebSocket连接
- [ ] 实现私信会话列表页面
- [ ] 实现私信聊天页面
- [ ] 实现系统消息列表页面
- [ ] 实现消息通知提示
- [ ] 实现消息实时更新

### 5.7 第七阶段：评论和收藏模块

#### 5.7.1 后端开发
- [ ] 实现评论发布接口
- [ ] 实现评论列表查询接口
- [ ] 实现评论回复接口
- [ ] 实现评论点赞接口
- [ ] 实现收藏功能接口
- [ ] 实现收藏列表查询接口

#### 5.7.2 前端开发
- [ ] 实现评论组件
- [ ] 实现评论列表展示
- [ ] 实现评论回复功能
- [ ] 实现收藏功能

### 5.8 第八阶段：信用评价系统

#### 5.8.1 后端开发
- [ ] 实现信用积分计算逻辑
- [ ] 实现信用等级评定
- [ ] 实现信用记录查询接口
- [ ] 实现信用统计接口

#### 5.8.2 前端开发
- [ ] 实现信用积分展示
- [ ] 实现信用记录页面
- [ ] 实现信用等级标识

### 5.9 第九阶段：数据统计模块（管理员）

#### 5.9.1 后端开发
- [ ] 实现用户统计接口
- [ ] 实现业务统计接口
- [ ] 实现数据导出功能
- [ ] 实现图表数据接口

#### 5.9.2 前端开发
- [ ] 实现数据统计页面
- [ ] 实现图表展示（ECharts）
- [ ] 实现数据导出功能

### 5.10 第十阶段：系统优化和测试

#### 5.10.1 后端优化
- [ ] 性能优化（数据库索引、缓存优化）
- [ ] 接口性能测试
- [ ] 安全加固
- [ ] 代码优化和重构

#### 5.10.2 前端优化
- [ ] 页面性能优化
- [ ] 用户体验优化
- [ ] 兼容性测试
- [ ] 代码优化和重构

#### 5.10.3 系统测试
- [ ] 功能测试
- [ ] 性能测试
- [ ] 安全测试
- [ ] 用户验收测试

## 七、技术要点

### 7.1 安全性
- JWT Token认证
- 密码加密存储（BCrypt）
- SQL注入防护
- XSS攻击防护
- CSRF防护
- 接口权限控制
- 敏感信息加密

### 7.2 性能优化
- Redis缓存热点数据
- 数据库索引优化
- 分页查询优化
- 图片压缩和CDN
- 接口响应时间优化

### 7.3 用户体验
- 响应式设计
- 加载状态提示
- 错误提示友好
- 操作反馈及时
- 数据实时更新

### 7.4 通用技术要点

#### 7.4.1 数据一致性保障

**需要注意的技术点：**

1. **分布式事务**
   - 跨服务操作时，使用分布式事务或最终一致性方案
   - 例如：订单创建 + 商品状态更新 + 消息通知

2. **数据冗余**
   - 订单表中冗余商品信息，避免商品删除后订单信息丢失
   - 订单表中冗余用户信息，便于历史订单查询

3. **数据同步**
   - 用户信息变更时，需要同步更新相关订单/任务中的冗余信息
   - 使用异步任务处理非关键数据同步

4. **数据校验**
   - 状态变更前，校验相关数据的完整性和一致性
   - 例如：订单状态变更前，校验商品状态、用户状态等

#### 7.4.2 异常处理和容错机制

**需要注意的技术点：**

1. **异常捕获**
   - 所有状态变更操作都需要捕获异常
   - 异常发生时，记录详细日志，便于排查问题

2. **状态回滚**
   - 操作失败时，自动回滚到上一个稳定状态
   - 使用数据库事务保证回滚的原子性

3. **补偿机制**
   - 对于异步操作，需要实现补偿机制
   - 例如：支付成功但订单状态更新失败，需要补偿更新订单状态

4. **重试机制**
   - 对于网络异常等临时性错误，实现重试机制
   - 设置最大重试次数，避免无限重试

#### 7.4.3 操作日志和审计

**需要注意的技术点：**

1. **操作日志记录**
   - 所有状态变更操作都需要记录操作日志
   - 日志包含：操作人、操作时间、操作类型、操作前状态、操作后状态、操作原因

2. **审计追踪**
   - 关键操作（如支付、退款）需要完整的审计追踪
   - 便于问题排查和责任追溯

3. **日志存储**
   - 操作日志需要持久化存储
   - 定期归档历史日志，避免日志表过大

### 7.5 错误提示规范

#### 7.5.1 通用错误提示

##### 7.5.1.1 参数验证错误
- **参数缺失**：`参数{参数名}不能为空`
- **参数格式错误**：`{参数名}格式不正确`
- **参数类型错误**：`{参数名}类型错误，期望{类型}`
- **参数范围错误**：`{参数名}超出允许范围（{最小值}-{最大值}）`

##### 7.5.1.2 权限错误
- **未登录**：`请先登录`
- **登录过期**：`登录已过期，请重新登录`
- **无权限**：`您没有权限执行此操作`
- **角色不符**：`当前角色无法执行此操作，需要{角色}权限`

##### 7.5.1.3 数据操作错误
- **数据不存在**：`{资源名称}不存在`
- **数据已存在**：`{资源名称}已存在`
- **数据已被删除**：`{资源名称}已被删除`
- **数据已被占用**：`{资源名称}已被{操作}，无法重复{操作}`

##### 7.5.1.4 状态错误
- **状态不正确**：`当前{资源名称}状态为{当前状态}，无法执行{操作}`
- **状态已变更**：`{资源名称}状态已变更，请刷新后重试`
- **状态冲突**：`{资源名称}状态冲突，无法执行此操作`

##### 7.5.1.5 并发错误
- **并发冲突**：`操作冲突，{资源名称}已被其他用户{操作}，请刷新后重试`
- **版本冲突**：`数据已被更新，请刷新后重试`

##### 7.5.1.6 系统错误
- **网络错误**：`网络连接失败，请检查网络设置`
- **服务器错误**：`服务器错误，请稍后重试`
- **服务不可用**：`服务暂时不可用，请稍后重试`
- **超时错误**：`请求超时，请稍后重试`

#### 7.5.2 用户管理模块错误提示

##### 7.5.2.1 注册登录错误
- **邮箱已注册**：`该邮箱已被注册，请使用其他邮箱或直接登录`
- **邮箱格式错误**：`邮箱格式不正确，请输入有效的邮箱地址`
- **验证码错误**：`验证码错误，请重新获取`
- **验证码过期**：`验证码已过期，请重新获取`
- **验证码已使用**：`验证码已使用，请重新获取`
- **密码强度不足**：`密码至少8位，且包含字母和数字`
- **密码错误**：`密码错误，请重新输入`
- **账号不存在**：`该邮箱未注册，请先注册`
- **账号已禁用**：`账号已被禁用，请联系管理员`
- **登录失败**：`登录失败，请检查邮箱和密码`

##### 7.5.2.2 用户信息更新错误
- **更新失败**：`用户信息更新失败，请稍后重试`
- **昵称已存在**：`该昵称已被使用，请使用其他昵称`
- **头像上传失败**：`头像上传失败，请检查图片格式和大小`
- **文件格式不支持**：`图片格式不支持，仅支持jpg、jpeg、png、gif格式`
- **文件过大**：`图片大小超过限制，单张图片不超过5MB`
- **实名认证已提交**：`实名认证信息已提交，请等待审核`
- **实名认证已通过**：`您已完成实名认证，无需重复提交`
- **实名认证审核中**：`实名认证正在审核中，请耐心等待`

#### 7.5.3 失物招领模块错误提示

##### 7.5.3.1 失物发布错误
- **发布失败**：`失物信息发布失败，请稍后重试`
- **必填项缺失**：`请填写完整的失物信息（物品名称、分类、描述、丢失时间、丢失地点）`
- **图片数量超限**：`图片数量超过限制，最多上传9张`
- **图片上传失败**：`图片上传失败，请检查图片格式和大小`
- **审核中无法修改**：`失物信息正在审核中，无法修改`
- **已认领无法修改**：`失物已被认领，无法修改`

##### 7.5.3.2 认领错误
- **认领失败**：`认领申请失败，请稍后重试`
- **已认领**：`该失物已被认领，无法重复认领`
- **认领中**：`该失物已有用户申请认领，请等待处理结果`
- **已关闭**：`该失物信息已关闭，无法认领`
- **不能认领自己的失物**：`不能认领自己发布的失物`
- **认领状态冲突**：`认领状态已变更，请刷新后重试`
- **确认认领失败**：`确认认领失败，请稍后重试`
- **拒绝认领失败**：`拒绝认领失败，请稍后重试`

#### 7.5.4 闲置交易模块错误提示

##### 7.5.4.1 商品发布错误
- **发布失败**：`商品发布失败，请稍后重试`
- **必填项缺失**：`请填写完整的商品信息（商品名称、分类、描述、原价、现价、交易方式）`
- **价格错误**：`现价不能大于原价，且价格必须大于0`
- **图片数量不足**：`至少上传1张商品图片`
- **图片数量超限**：`图片数量超过限制，最多上传9张`
- **面交地点缺失**：`面交方式必须填写交易地点`
- **商品已售出**：`商品已售出，无法修改`
- **商品审核中**：`商品正在审核中，无法修改`

##### 7.5.4.2 订单错误
- **下单失败**：`下单失败，请稍后重试`
- **商品已售出**：`商品已售出，无法下单`
- **商品已下架**：`商品已下架，无法下单`
- **不能购买自己的商品**：`不能购买自己发布的商品`
- **订单状态错误**：`订单状态为{当前状态}，无法执行{操作}`
- **支付失败**：`支付失败，请稍后重试`
- **订单已支付**：`订单已支付，无需重复支付`
- **订单已取消**：`订单已取消，无法执行此操作`
- **订单已退款**：`订单已退款，无法执行此操作`
- **发货失败**：`发货失败，请稍后重试`
- **确认收货失败**：`确认收货失败，请稍后重试`
- **取消订单失败**：`取消订单失败，请稍后重试`
- **退款申请失败**：`退款申请失败，请稍后重试`
- **退款处理失败**：`退款处理失败，请稍后重试`

##### 7.5.4.3 商品状态错误
- **商品状态冲突**：`商品状态已变更，无法执行此操作`
- **下架失败**：`商品下架失败，请稍后重试`
- **上架失败**：`商品上架失败，请稍后重试`
- **商品有订单**：`商品存在进行中的订单，无法下架`

#### 7.5.5 跑腿服务模块错误提示

##### 7.5.5.1 任务发布错误
- **发布失败**：`任务发布失败，请稍后重试`
- **必填项缺失**：`请填写完整的任务信息（任务类型、标题、描述、起始地点、目的地、期望完成时间、报酬金额）`
- **时间错误**：`期望完成时间不能早于当前时间`
- **报酬错误**：`报酬金额必须大于0`
- **图片数量超限**：`图片数量超过限制，最多上传3张`
- **任务审核中**：`任务正在审核中，无法修改`
- **任务已接单**：`任务已被接单，无法修改`
- **任务已完成**：`任务已完成，无法修改`

##### 7.5.5.2 接单错误
- **接单失败**：`接单失败，请稍后重试`
- **任务不存在**：`任务不存在或已被删除`
- **任务已接单**：`该任务已被其他用户接单`
- **任务状态错误**：`任务状态为{当前状态}，无法接单`
- **无接单权限**：`您尚未完成实名认证，无法接单`
- **不能接自己的任务**：`不能接取自己发布的任务`
- **接单冲突**：`任务已被其他用户接单，请刷新后查看`
- **开始任务失败**：`开始任务失败，请稍后重试`
- **任务未接单**：`任务尚未被接单，无法开始`
- **任务已开始**：`任务已开始，无需重复操作`

##### 7.5.5.3 任务状态错误
- **状态变更失败**：`任务状态变更失败，请稍后重试`
- **状态不正确**：`任务当前状态为{当前状态}，无法变更为{目标状态}`
- **权限不足**：`只有{角色}才能执行此操作`
- **完成任务失败**：`完成任务失败，请稍后重试`
- **确认完成失败**：`确认完成失败，请稍后重试`
- **取消任务失败**：`取消任务失败，请稍后重试`
- **进度更新失败**：`进度更新失败，请稍后重试`

##### 7.5.5.4 报酬支付错误
- **支付失败**：`报酬支付失败，请稍后重试`
- **任务未完成**：`任务尚未完成，无法支付报酬`
- **报酬已支付**：`报酬已支付，无需重复支付`
- **支付金额错误**：`支付金额与任务报酬不匹配`

#### 7.5.6 消息通知模块错误提示

##### 7.5.6.1 私信错误
- **发送失败**：`消息发送失败，请稍后重试`
- **消息内容为空**：`消息内容不能为空`
- **消息过长**：`消息内容过长，最多{字数}字`
- **图片上传失败**：`图片上传失败，请检查图片格式和大小`
- **会话不存在**：`会话不存在或已被删除`
- **不能给自己发消息**：`不能给自己发送消息`
- **用户不存在**：`目标用户不存在或已被禁用`

##### 7.5.6.2 系统消息错误
- **消息创建失败**：`系统消息创建失败，请稍后重试`
- **消息不存在**：`消息不存在或已被删除`
- **已读标记失败**：`已读标记失败，请稍后重试`

##### 7.5.6.3 WebSocket错误
- **连接失败**：`WebSocket连接失败，请检查网络`
- **认证失败**：`WebSocket认证失败，请重新登录`
- **连接断开**：`连接已断开，正在尝试重连...`
- **重连失败**：`重连失败，请刷新页面`

#### 7.5.7 评论收藏模块错误提示

##### 7.5.7.1 评论错误
- **评论失败**：`评论发布失败，请稍后重试`
- **评论内容为空**：`评论内容不能为空`
- **评论过长**：`评论内容过长，最多{字数}字`
- **目标不存在**：`评论目标不存在或已被删除`
- **不能评论自己的内容**：`不能评论自己发布的内容`
- **回复失败**：`回复失败，请稍后重试`
- **父评论不存在**：`父评论不存在或已被删除`
- **点赞失败**：`点赞失败，请稍后重试`
- **已点赞**：`您已点赞过该评论`
- **取消点赞失败**：`取消点赞失败，请稍后重试`

##### 7.5.7.2 收藏错误
- **收藏失败**：`收藏失败，请稍后重试`
- **已收藏**：`您已收藏过该{资源类型}`
- **取消收藏失败**：`取消收藏失败，请稍后重试`
- **未收藏**：`您尚未收藏该{资源类型}`
- **目标不存在**：`收藏目标不存在或已被删除`

#### 7.5.8 管理员模块错误提示

##### 7.5.8.1 审核错误
- **审核失败**：`审核失败，请稍后重试`
- **已审核**：`该{资源类型}已审核，无需重复审核`
- **审核状态冲突**：`审核状态已变更，请刷新后重试`
- **审核原因缺失**：`拒绝审核必须填写审核原因`

##### 7.5.8.2 用户管理错误
- **用户不存在**：`用户不存在或已被删除`
- **禁用失败**：`用户禁用失败，请稍后重试`
- **启用失败**：`用户启用失败，请稍后重试`
- **不能操作自己**：`不能对自己执行此操作`
- **不能操作管理员**：`不能对管理员执行此操作`

#### 7.5.9 文件上传错误提示

##### 7.5.9.1 通用上传错误
- **上传失败**：`文件上传失败，请稍后重试`
- **文件为空**：`请选择要上传的文件`
- **文件格式不支持**：`文件格式不支持，仅支持{格式列表}`
- **文件过大**：`文件大小超过限制，最大{大小}`
- **文件数量超限**：`文件数量超过限制，最多{数量}个`
- **存储空间不足**：`存储空间不足，请联系管理员`

##### 7.5.9.2 图片上传错误
- **图片格式错误**：`图片格式不支持，仅支持jpg、jpeg、png、gif格式`
- **图片过大**：`图片大小超过限制，单张图片不超过5MB`
- **图片损坏**：`图片文件损坏，请重新选择`
- **图片尺寸错误**：`图片尺寸不符合要求（{要求}）`

#### 7.5.10 错误提示使用规范

##### 7.5.10.1 提示信息原则
- **及时反馈**：操作后立即显示错误提示，不延迟
- **信息明确**：错误提示说明具体原因，提供解决方案
- **用户友好**：使用通俗易懂的语言，避免技术术语
- **位置合理**：错误提示显示在相关操作附近，易于发现
- **样式统一**：使用Element Plus统一的错误提示样式

##### 7.5.10.2 提示信息格式
- **成功提示**：`{操作}成功`（如：`发布成功`、`更新成功`）
- **失败提示**：`{操作}失败，{原因}`（如：`发布失败，请稍后重试`）
- **警告提示**：`{警告信息}，{建议}`（如：`该操作不可撤销，请确认后继续`）
- **确认提示**：`确定要{操作}吗？`（如：`确定要删除该商品吗？`）

##### 7.5.10.3 提示信息示例
```javascript
// 成功提示
ElMessage.success('发布成功')
ElMessage.success('更新成功')
ElMessage.success('删除成功')

// 错误提示
ElMessage.error('发布失败，请稍后重试')
ElMessage.error('更新失败，数据已被其他用户修改，请刷新后重试')
ElMessage.error('删除失败，该商品存在进行中的订单')

// 警告提示
ElMessage.warning('该操作不可撤销，请确认后继续')
ElMessage.warning('订单已支付，取消后将无法恢复')

// 确认提示
ElMessageBox.confirm('确定要删除该商品吗？', '提示', {
  confirmButtonText: '确定',
  cancelButtonText: '取消',
  type: 'warning'
})
```

## 八、附录

### 7.1 状态枚举定义

#### 7.1.1 失物招领状态
```java
public enum LostFoundStatus {
    PENDING("待认领"),
    CLAIMING("认领中"),
    CLAIMED("已认领"),
    CLOSED("已关闭");
}
```

#### 7.1.2 订单状态
```java
public enum OrderStatus {
    PENDING_PAY("待付款"),
    PENDING_SHIP("待发货"),
    PENDING_RECEIVE("待收货"),
    PENDING_EVALUATE("待评价"),
    COMPLETED("已完成"),
    CANCELLED("已取消"),
    REFUNDING("退款中"),
    REFUNDED("已退款");
}
```

#### 7.1.3 跑腿任务状态
```java
public enum ErrandTaskStatus {
    PENDING("待接单"),
    ACCEPTED("已接单"),
    IN_PROGRESS("进行中"),
    PENDING_CONFIRM("待确认"),
    COMPLETED("已完成"),
    CANCELLED("已取消"),
    APPEALING("申诉中"),
    APPEAL_COMPLETED("申诉完成");
}
```

### 7.2 API接口规范

#### 7.2.1 统一响应格式
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {},
  "timestamp": 1704067200000
}
```

#### 7.2.2 分页响应格式
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "records": [],
    "total": 100,
    "size": 10,
    "current": 1,
    "pages": 10
  },
  "timestamp": 1704067200000
}
```

### 7.3 文件上传规范

- 图片格式：jpg、jpeg、png、gif
- 图片大小：单张不超过5MB
- 图片数量：失物招领最多9张，商品至少1张最多9张，跑腿任务最多3张
- 存储路径：`/uploads/{module}/{date}/{filename}`

---

**文档版本：** v1.0  
**最后更新：** 2024-01-01  
**文档维护：** 开发团队

