# 学习互助模块功能设计文档

**文档版本：** v1.0  
**创建日期：** 2024-12-05  
**文档维护：** 开发团队

---

## 一、模块概述

### 1.1 功能定位

学习互助模块是校园互助系统的核心功能之一，采用**问答社区**的业务模式，为校园用户提供学习问题解答服务。用户可以通过平台发布学习难题，其他用户可以选择回答并提供解答，发布者可以采纳最佳答案。支持悬赏机制，发布者可以设置酬劳（可选），采纳答案后支付酬劳。

### 1.2 核心特性

- ✅ **问题发布**：用户可发布各类学习问题，设置酬劳（可选）、分类、图片等
- ✅ **问题浏览**：支持分类筛选、关键词搜索、酬劳筛选、状态筛选
- ✅ **回答功能**：所有用户都可以回答问题，支持文字和图片
- ✅ **采纳答案**：发布者可以采纳最佳答案，采纳后支付酬劳（如果有）
- ✅ **状态管理**：完整的问题状态管理（待解答→已回答→已解决）
- ✅ **智能审核**：发布问题时自动进行敏感词检测和智能审核

---

## 二、功能详细设计

### 2.1 问题分类

**支持的问题分类：**

| 分类代码 | 分类名称 | 说明 | 示例 |
|---------|---------|------|------|
| `MATH` | 数学 | 数学相关问题 | 高等数学、线性代数、概率论、微积分等 |
| `PHYSICS` | 物理 | 物理相关问题 | 大学物理、理论物理、量子力学等 |
| `CHEMISTRY` | 化学 | 化学相关问题 | 有机化学、无机化学、分析化学等 |
| `BIOLOGY` | 生物 | 生物相关问题 | 生物学、生物化学、遗传学等 |
| `COMPUTER` | 计算机 | 计算机相关问题 | 编程、算法、数据结构、软件工程等 |
| `ENGLISH` | 英语 | 英语相关问题 | 翻译、语法、写作、口语等 |
| `LITERATURE` | 文学 | 文学相关问题 | 语文、文学理论、古代文学等 |
| `HISTORY` | 历史 | 历史相关问题 | 中国史、世界史、历史理论等 |
| `PHILOSOPHY` | 哲学 | 哲学相关问题 | 马克思主义哲学、西方哲学等 |
| `ECONOMICS` | 经济 | 经济相关问题 | 经济学、金融学、国际贸易等 |
| `MANAGEMENT` | 管理 | 管理相关问题 | 管理学、工商管理、人力资源等 |
| `LAW` | 法律 | 法律相关问题 | 法学、宪法、民法、刑法等 |
| `EDUCATION` | 教育 | 教育相关问题 | 教育学、心理学、教育技术等 |
| `ART` | 艺术 | 艺术相关问题 | 美术、音乐、设计等 |
| `ENGINEERING` | 工程 | 工程相关问题 | 机械工程、电子工程、土木工程等 |
| `MEDICINE` | 医学 | 医学相关问题 | 临床医学、基础医学、药学等 |
| `AGRICULTURE` | 农学 | 农学相关问题 | 农学、园艺、植物保护等 |
| `OTHER` | 其他 | 其他学科问题 | 其他自定义问题 |

### 2.2 问题状态流转

**完整的状态流转图：**

```
发布问题
    ↓
PENDING_REVIEW (待审核)
    ↓ (审核通过)
PENDING_ANSWER (待解答)
    ↓ (有用户回答)
ANSWERED (已回答)
    ↓ (发布者采纳答案)
SOLVED (已解决)
```

**状态说明：**

| 状态代码 | 状态名称 | 说明 | 可执行操作 |
|---------|---------|------|-----------|
| `PENDING_REVIEW` | 待审核 | 问题发布后等待管理员审核 | 管理员审核、用户取消 |
| `PENDING_ANSWER` | 待解答 | 审核通过，等待用户回答 | 用户回答、发布者取消 |
| `ANSWERED` | 已回答 | 已有用户回答，但未采纳 | 发布者采纳答案、继续回答 |
| `SOLVED` | 已解决 | 已采纳最佳答案，酬劳已支付 | 查看详情 |
| `CANCELLED` | 已取消 | 问题被取消 | 无 |
| `REJECTED` | 已拒绝 | 审核被拒绝 | 无 |
| `ADMIN_OFFSHELF` | 已下架 | 管理员下架 | 无 |

**状态流转规则：**

1. **发布问题** → `PENDING_REVIEW`
   - 发布问题后自动进入待审核状态
   - 触发智能审核（敏感词检测、发布频率检测、新用户检测）

2. **审核通过** → `PENDING_ANSWER`
   - 管理员审核通过或自动审核通过
   - 问题对外可见，可被回答

3. **有用户回答** → `ANSWERED`
   - 任何用户都可以回答问题
   - 一个问题可以有多个回答
   - 问题状态更新为已回答

4. **采纳答案** → `SOLVED`
   - 发布者选择最佳答案并采纳
   - 如果有酬劳，系统处理酬劳支付（模拟）
   - 问题状态更新为已解决
   - 发送系统消息通知被采纳的回答者

5. **取消问题**
   - 发布者可在 `PENDING_ANSWER` 或 `ANSWERED` 状态取消
   - 取消后状态变为 `CANCELLED`
   - 如果有酬劳，酬劳退回（可选功能）

### 2.3 问题发布功能

#### 2.3.1 发布页面

**路由：** `/question/publish`

**页面布局：**
```
┌─────────────────────────────────────┐
│  发布学习问题                        │
├─────────────────────────────────────┤
│  问题分类： [下拉选择]               │
│  问题标题： [输入框]                 │
│  问题描述： [多行文本]               │
│  问题图片： [图片上传，最多3张]      │
│  悬赏金额： [数字输入框] 元（可选）  │
│                                    │
│  [发布问题] 按钮                    │
└─────────────────────────────────────┘
```

**表单验证：**
- 问题分类：必填
- 问题标题：必填，长度1-200字符
- 问题描述：必填，长度10-2000字符
- 问题图片：可选，最多3张
- 悬赏金额：可选，如果填写，范围0.01-9999.99元；如果不填写，默认为0（无酬劳）

**权限验证：**
- ✅ **所有用户都可以发布问题**（无需实名认证）
- 未登录用户需要先登录

#### 2.3.2 后端接口

**接口：** `POST /api/question/publish`

**请求体：**
```json
{
  "category": "MATH",
  "title": "高等数学求极限问题",
  "description": "求 lim(x→0) (sin x)/x 的极限值，需要详细步骤",
  "images": ["image1.jpg", "image2.jpg"],
  "reward": 5.00
}
```

**响应：**
```json
{
  "code": 200,
  "message": "发布成功",
  "data": 12345
}
```

**业务逻辑：**
1. 验证表单数据
2. 敏感词检测（使用AC自动机）
3. 发布频率检测（同一用户1小时内最多发布5条）
4. 新用户检测（注册7天内为新用户）
5. 智能审核判定：
   - 包含严重敏感词 → 自动拒绝（`REJECTED`）
   - 通过检测且非新用户 → 自动通过（`PENDING_ANSWER`）
   - 其他情况 → 转人工审核（`PENDING_REVIEW`）
6. 保存问题到数据库
7. 如需人工审核，发送系统消息给所有管理员
8. 返回问题ID

### 2.4 问题列表功能

#### 2.4.1 列表页面

**路由：** `/question/list`

**页面布局：**
```
┌─────────────────────────────────────┐
│  学习互助                            │
├─────────────────────────────────────┤
│  [筛选栏]                            │
│  分类：[全部/数学/物理/计算机/...]   │
│  状态：[全部/待解答/已回答/已解决]   │
│  酬劳：[全部/有酬劳/无酬劳]         │
│  关键词：[搜索框]                    │
│                                    │
│  [问题卡片列表]                     │
│  ┌─────────┐ ┌─────────┐          │
│  │ 问题卡片 │ │ 问题卡片 │          │
│  └─────────┘ └─────────┘          │
│                                    │
│  [分页组件]                         │
└─────────────────────────────────────┘
```

**问题卡片显示内容：**
- 问题分类标签
- 问题标题
- 问题描述（截取前100字）
- 悬赏金额（如果有，突出显示；如果没有，显示"无酬劳"）
- 问题状态标签
- 回答数量
- 发布者头像和昵称
- 发布时间
- 操作按钮（查看详情、回答等）

**筛选功能：**
- 按问题分类筛选
- 按问题状态筛选（默认只显示 `PENDING_ANSWER` 和 `ANSWERED` 状态）
- 按酬劳筛选（全部/有酬劳/无酬劳）
- 关键词搜索（标题、描述）

**排序功能：**
- 默认：按发布时间倒序
- 按酬劳从高到低
- 按回答数量（热门优先）
- 按最新回答时间

#### 2.4.2 后端接口

**接口：** `GET /api/question/list`

**查询参数：**
```
category: 问题分类（可选）
status: 问题状态（可选，默认PENDING_ANSWER,ANSWERED）
hasReward: 是否有酬劳（可选：true/false）
keyword: 关键词（可选）
pageNum: 页码（默认1）
pageSize: 每页数量（默认10）
sortBy: 排序方式（latest/reward/popular/recent_answer）
```

**响应：**
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "records": [
      {
        "id": 12345,
        "category": "MATH",
        "title": "高等数学求极限问题",
        "description": "求 lim(x→0) (sin x)/x 的极限值...",
        "reward": 5.00,
        "status": "PENDING_ANSWER",
        "answerCount": 0,
        "user": {
          "id": 1001,
          "nickname": "张三",
          "avatar": "avatar.jpg"
        },
        "createTime": "2024-12-05 10:00:00",
        "viewCount": 10
      }
    ],
    "total": 100,
    "current": 1,
    "size": 10
  }
}
```

### 2.5 问题详情功能

#### 2.5.1 详情页面

**路由：** `/question/detail/:id`

**页面布局：**
```
┌─────────────────────────────────────┐
│  [返回] 问题详情                     │
├─────────────────────────────────────┤
│  [问题图片轮播]                     │
│                                    │
│  问题分类：[标签]                   │
│  问题标题：高等数学求极限问题        │
│  问题状态：[状态标签]               │
│  悬赏金额：¥5.00（如果有）          │
│                                    │
│  问题描述：                         │
│  求 lim(x→0) (sin x)/x 的极限值... │
│                                    │
│  发布者信息：                       │
│  [头像] 张三                        │
│                                    │
│  [回答列表]                         │
│  ┌─────────────────────────────┐   │
│  │ [头像] 李四                  │   │
│  │ 回答内容：...                │   │
│  │ [采纳答案] 按钮（仅发布者）  │   │
│  └─────────────────────────────┘   │
│                                    │
│  [回答输入框]                       │
│  [提交回答] 按钮                    │
└─────────────────────────────────────┘
```

**权限控制：**
- 所有用户可查看问题详情（审核通过的问题）
- 发布者可查看自己发布的问题（包括待审核、已拒绝状态）
- 管理员可查看所有问题

**操作按钮显示规则：**
- **待解答状态（PENDING_ANSWER）**：
  - 所有用户：显示"回答"按钮
  - 发布者：显示"取消问题"按钮
- **已回答状态（ANSWERED）**：
  - 所有用户：显示"回答"按钮（可以继续回答）
  - 发布者：显示"采纳答案"按钮（每个回答旁边）和"取消问题"按钮
- **已解决状态（SOLVED）**：
  - 所有用户：显示问题信息和已采纳的答案（只读）
  - 发布者：显示"查看详情"按钮

#### 2.5.2 后端接口

**接口：** `GET /api/question/detail/:id`

**响应：**
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "id": 12345,
    "category": "MATH",
    "title": "高等数学求极限问题",
    "description": "求 lim(x→0) (sin x)/x 的极限值，需要详细步骤",
    "images": ["image1.jpg", "image2.jpg"],
    "reward": 5.00,
    "status": "ANSWERED",
    "answerCount": 2,
    "acceptedAnswerId": null,
    "user": {
      "id": 1001,
      "nickname": "张三",
      "avatar": "avatar.jpg"
    },
    "answers": [
      {
        "id": 10001,
        "content": "根据洛必达法则...",
        "images": ["answer1.jpg"],
        "user": {
          "id": 1002,
          "nickname": "李四",
          "avatar": "avatar2.jpg"
        },
        "createTime": "2024-12-05 11:00:00",
        "isAccepted": false
      }
    ],
    "createTime": "2024-12-05 10:00:00",
    "viewCount": 10
  }
}
```

**业务逻辑：**
1. 查询问题信息
2. 权限验证（发布者、管理员可查看所有状态，其他用户只能查看审核通过的问题）
3. 增加浏览量（仅审核通过的问题）
4. 填充用户信息（发布者）
5. 查询回答列表（按创建时间倒序）
6. 返回问题详情和回答列表

### 2.6 回答功能

#### 2.6.1 回答流程

**回答按钮点击流程：**
```
用户点击"回答"按钮
    ↓
填写回答内容（文字+图片，可选）
    ↓
提交回答请求
    ↓
保存回答到数据库
    ↓
更新问题状态（如果之前是待解答，更新为已回答）
    ↓
更新问题回答数量
    ↓
发送系统消息通知发布者
```

#### 2.6.2 后端接口

**接口：** `POST /api/question/:id/answer`

**请求体：**
```json
{
  "content": "根据洛必达法则，lim(x→0) (sin x)/x = lim(x→0) cos x = 1",
  "images": ["answer1.jpg"]
}
```

**响应：**
```json
{
  "code": 200,
  "message": "回答成功",
  "data": {
    "answerId": 10001,
    "questionId": 12345
  }
}
```

**业务逻辑：**
1. 验证用户已登录
2. 查询问题信息
3. 验证问题状态（必须是 `PENDING_ANSWER` 或 `ANSWERED`，不能是已解决）
4. 验证不能回答自己的问题（可选，也可以允许）
5. 敏感词检测（回答内容）
6. 保存回答到数据库
7. 如果问题状态是 `PENDING_ANSWER`，更新为 `ANSWERED`
8. 更新问题回答数量
9. 发送系统消息通知发布者
10. 返回回答ID

### 2.7 采纳答案功能

#### 2.7.1 采纳流程

**采纳答案流程：**
```
发布者点击"采纳答案"按钮
    ↓
确认采纳对话框
    ↓
提交采纳请求
    ↓
验证问题状态和权限
    ↓
更新问题状态为已解决
    ↓
标记答案为已采纳
    ↓
如果有酬劳，处理酬劳支付（模拟）
    ↓
发送系统消息通知被采纳的回答者
```

#### 2.7.2 后端接口

**接口：** `POST /api/question/:id/accept-answer`

**请求体：**
```json
{
  "answerId": 10001
}
```

**响应：**
```json
{
  "code": 200,
  "message": "采纳成功",
  "data": null
}
```

**业务逻辑：**
1. 验证用户是发布者
2. 查询问题信息
3. 验证问题状态（必须是 `ANSWERED`）
4. 查询回答信息
5. 验证回答属于该问题
6. 更新问题状态为 `SOLVED`
7. 标记答案为已采纳（`is_accepted = 1`）
8. 记录采纳时间
9. 如果有酬劳（`reward > 0`），处理酬劳支付（模拟，实际可对接支付系统）
10. 发送系统消息通知被采纳的回答者
11. 返回成功

### 2.8 我的问题/我的回答

#### 2.8.1 我的问题

**路由：** `/user/questions/published`

**功能：** 显示当前用户发布的所有问题

**筛选：** 按问题状态筛选（全部/待解答/已回答/已解决/已取消）

#### 2.8.2 我的回答

**路由：** `/user/questions/answered`

**功能：** 显示当前用户回答的所有问题

**筛选：** 按问题状态筛选（全部/待解答/已回答/已解决）

#### 2.8.3 后端接口

**接口：** `GET /api/question/my/published` 和 `GET /api/question/my/answered`

**查询参数：**
```
status: 问题状态（可选）
pageNum: 页码
pageSize: 每页数量
```

---

## 三、数据库设计

### 3.1 学习问题表（study_question）

**表结构：**
```sql
CREATE TABLE `study_question` (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '问题ID',
  `user_id` BIGINT(20) NOT NULL COMMENT '发布者ID',
  `title` VARCHAR(200) NOT NULL COMMENT '问题标题',
  `category` VARCHAR(50) NOT NULL COMMENT '问题分类：MATH-数学，PHYSICS-物理，CHEMISTRY-化学，BIOLOGY-生物，COMPUTER-计算机，ENGLISH-英语，LITERATURE-文学，HISTORY-历史，PHILOSOPHY-哲学，ECONOMICS-经济，MANAGEMENT-管理，LAW-法律，EDUCATION-教育，ART-艺术，ENGINEERING-工程，MEDICINE-医学，AGRICULTURE-农学，OTHER-其他',
  `description` TEXT NOT NULL COMMENT '问题描述',
  `images` TEXT DEFAULT NULL COMMENT '问题图片（JSON数组，最多3张）',
  `reward` DECIMAL(10, 2) DEFAULT 0.00 COMMENT '悬赏金额（可选，0表示无酬劳）',
  
  -- 状态字段
  `status` VARCHAR(20) DEFAULT 'PENDING_REVIEW' COMMENT '状态：PENDING_REVIEW-待审核，PENDING_ANSWER-待解答，ANSWERED-已回答，SOLVED-已解决，CANCELLED-已取消，REJECTED-已拒绝，ADMIN_OFFSHELF-已下架',
  
  -- 审核字段
  `audit_status` VARCHAR(20) DEFAULT 'PENDING' COMMENT '审核状态：PENDING-待审核，APPROVED-已通过，REJECTED-已拒绝',
  `audit_reason` VARCHAR(500) DEFAULT NULL COMMENT '审核拒绝原因',
  `audit_time` DATETIME DEFAULT NULL COMMENT '审核时间',
  `audit_admin_id` BIGINT(20) DEFAULT NULL COMMENT '审核管理员ID',
  `audit_trigger_reason` VARCHAR(500) DEFAULT NULL COMMENT '触发人工审核原因',
  
  -- 下架字段
  `offshelf_type` VARCHAR(20) DEFAULT NULL COMMENT '下架类型',
  `offshelf_reason` VARCHAR(500) DEFAULT NULL COMMENT '下架原因',
  `offshelf_time` DATETIME DEFAULT NULL COMMENT '下架时间',
  `offshelf_admin_id` BIGINT(20) DEFAULT NULL COMMENT '下架管理员ID',
  
  -- 采纳信息
  `accepted_answer_id` BIGINT(20) DEFAULT NULL COMMENT '已采纳的回答ID',
  `accept_time` DATETIME DEFAULT NULL COMMENT '采纳时间',
  
  -- 统计字段
  `view_count` INT(11) DEFAULT 0 COMMENT '浏览次数',
  `answer_count` INT(11) DEFAULT 0 COMMENT '回答数量',
  
  -- 系统字段
  `delete_flag` TINYINT(1) DEFAULT 0 COMMENT '逻辑删除：0-未删除，1-已删除',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '发布时间',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_category` (`category`),
  KEY `idx_status` (`status`),
  KEY `idx_audit_status` (`audit_status`),
  KEY `idx_reward` (`reward`),
  KEY `idx_view_count` (`view_count`),
  KEY `idx_answer_count` (`answer_count`),
  KEY `idx_status_reward` (`status`, `reward` DESC),
  KEY `idx_status_create_time` (`status`, `create_time` DESC),
  KEY `idx_create_time` (`create_time`),
  CONSTRAINT `fk_study_question_user` FOREIGN KEY (`user_id`) REFERENCES `user` (`id`),
  CONSTRAINT `fk_study_question_answer` FOREIGN KEY (`accepted_answer_id`) REFERENCES `study_answer` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='学习问题表';
```

### 3.2 学习回答表（study_answer）

**表结构：**
```sql
CREATE TABLE `study_answer` (
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT '回答ID',
  `question_id` BIGINT(20) NOT NULL COMMENT '问题ID',
  `user_id` BIGINT(20) NOT NULL COMMENT '回答者ID',
  `content` TEXT NOT NULL COMMENT '回答内容',
  `images` TEXT DEFAULT NULL COMMENT '回答图片（JSON数组，最多3张）',
  `is_accepted` TINYINT(1) DEFAULT 0 COMMENT '是否被采纳：0-未采纳，1-已采纳',
  `accept_time` DATETIME DEFAULT NULL COMMENT '采纳时间',
  
  -- 统计字段
  `like_count` INT(11) DEFAULT 0 COMMENT '点赞数量（可选功能）',
  
  -- 系统字段
  `delete_flag` TINYINT(1) DEFAULT 0 COMMENT '逻辑删除：0-未删除，1-已删除',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '回答时间',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  
  PRIMARY KEY (`id`),
  KEY `idx_question_id` (`question_id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_is_accepted` (`is_accepted`),
  KEY `idx_create_time` (`create_time`),
  CONSTRAINT `fk_study_answer_question` FOREIGN KEY (`question_id`) REFERENCES `study_question` (`id`),
  CONSTRAINT `fk_study_answer_user` FOREIGN KEY (`user_id`) REFERENCES `user` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='学习回答表';
```

---

## 四、状态流转详细说明

### 4.1 状态流转图

```
                   发布问题
                      ↓
            ┌─────────────────┐
            │  PENDING_REVIEW │ 待审核
            └────────┬────────┘
                     │
         ┌───────────┴───────────┐
         │                       │
   审核通过                  审核拒绝
         │                       │
         ↓                       ↓
┌─────────────────┐    ┌─────────────────┐
│ PENDING_ANSWER  │    │    REJECTED     │ 已拒绝
│   待解答        │    └─────────────────┘
└────────┬────────┘
         │
    有用户回答
         │
         ↓
┌─────────────────┐
│   ANSWERED      │ 已回答
│                 │
└────────┬────────┘
         │
   采纳答案
         │
         ↓
┌─────────────────┐
│    SOLVED       │ 已解决
│                 │
└─────────────────┘
```

### 4.2 状态操作权限表

| 状态 | 发布者可操作 | 回答者可操作 | 管理员可操作 |
|------|------------|------------|------------|
| `PENDING_REVIEW` | 取消问题 | - | 审核通过/拒绝 |
| `PENDING_ANSWER` | 取消问题 | 回答问题 | 下架 |
| `ANSWERED` | 采纳答案、取消问题 | 继续回答问题 | 下架 |
| `SOLVED` | 查看详情 | 查看详情 | 查看详情 |
| `CANCELLED` | 查看详情 | 查看详情 | 查看详情 |
| `REJECTED` | 查看详情、重新发布 | - | 查看详情 |
| `ADMIN_OFFSHELF` | 查看详情 | 查看详情 | 查看详情 |

### 4.3 状态变更触发事件

| 状态变更 | 触发事件 | 接收者 |
|---------|---------|--------|
| `PENDING_REVIEW` → `PENDING_ANSWER` | 审核通过 | 发布者 |
| `PENDING_REVIEW` → `REJECTED` | 审核拒绝 | 发布者 |
| `PENDING_ANSWER` → `ANSWERED` | 收到回答 | 发布者 |
| `ANSWERED` → `SOLVED` | 答案被采纳 | 被采纳的回答者 |

---

## 五、API接口清单

### 5.1 问题管理接口

| 接口 | 方法 | 路径 | 说明 |
|------|------|------|------|
| 发布问题 | POST | `/api/question/publish` | 发布学习问题（无需实名认证） |
| 问题列表 | GET | `/api/question/list` | 获取问题列表（支持筛选、排序、分页） |
| 问题详情 | GET | `/api/question/detail/:id` | 获取问题详情 |
| 回答问题 | POST | `/api/question/:id/answer` | 回答问题 |
| 采纳答案 | POST | `/api/question/:id/accept-answer` | 采纳最佳答案（仅发布者） |
| 取消问题 | POST | `/api/question/:id/cancel` | 取消问题（仅发布者） |
| 我的问题 | GET | `/api/question/my/published` | 获取我发布的问题列表 |
| 我的回答 | GET | `/api/question/my/answered` | 获取我回答的问题列表 |

### 5.2 管理员接口

| 接口 | 方法 | 路径 | 说明 |
|------|------|------|------|
| 待审核问题列表 | GET | `/api/admin/question/pending` | 获取待审核问题列表 |
| 审核问题 | POST | `/api/admin/question/:id/audit` | 审核问题（通过/拒绝） |

---

## 六、前端页面清单

### 6.1 用户页面

| 页面 | 路由 | 说明 |
|------|------|------|
| 问题列表 | `/question/list` | 浏览和搜索问题 |
| 问题详情 | `/question/detail/:id` | 查看问题详情和回答 |
| 发布问题 | `/question/publish` | 发布新问题 |
| 编辑问题 | `/question/edit/:id` | 编辑问题（仅发布者，仅待审核/已拒绝状态） |
| 我的问题 | `/user/questions/published` | 我发布的问题 |
| 我的回答 | `/user/questions/answered` | 我回答的问题 |

### 6.2 管理员页面

| 页面 | 路由 | 说明 |
|------|------|------|
| 问题审核 | `/admin/question-audit` | 审核学习问题 |

---

## 七、开发注意事项

### 7.1 权限验证

- **发布问题**：所有登录用户都可以发布（无需实名认证）
- **回答问题**：所有登录用户都可以回答（无需实名认证）
- **采纳答案**：只有发布者可以采纳答案
- **查看详情**：发布者可查看自己的所有问题，其他用户只能查看审核通过的问题

### 7.2 智能审核

- **敏感词检测**：使用AC自动机进行敏感词检测
- **发布频率限制**：同一用户1小时内最多发布5条问题
- **新用户检测**：注册7天内为新用户，需要人工审核
- **自动审核规则**：
  - 包含严重敏感词 → 自动拒绝
  - 通过检测且非新用户 → 自动通过
  - 其他情况 → 转人工审核

### 7.3 酬劳机制

- **酬劳设置**：发布者可以选择是否设置酬劳（0表示无酬劳）
- **酬劳支付**：采纳答案后，如果有酬劳，系统处理酬劳支付（模拟，实际可对接支付系统）
- **酬劳退回**：取消问题时，如果有酬劳且未采纳答案，酬劳退回（可选功能）

### 7.4 系统消息

- **回答通知**：问题收到回答时通知发布者
- **采纳通知**：答案被采纳时通知回答者
- **审核通知**：问题审核结果通知发布者

---

## 八、后续整合说明

本文档设计完成后，将整合到 `功能开发需求文档.md` 的 **2.4 学习互助模块** 章节，替换原有的跑腿模块需求，提供更详细的功能设计和实现指导。

**整合位置：** `doc/功能开发需求文档.md` 第 3058 行开始

**整合方式：**
1. 替换 2.4 节的功能设计内容
2. 补充状态流转图和详细说明
3. 更新数据库表设计（3.5节）

---

**文档结束**

