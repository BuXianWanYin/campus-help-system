# 校园帮系统功能文档

## 一、系统概述

校园帮系统是一个面向高校学生的综合性互助服务平台，旨在为学生提供失物招领、闲置交易、学习互助等多种服务功能。系统采用前后端分离架构，前端基于Vue 3开发，后端基于Spring Boot开发，支持WebSocket实时通信。

## 二、用户角色

系统支持两种用户角色：
- **普通用户（USER）**：可以发布内容、进行交易、参与互助等
- **管理员（ADMIN）**：负责内容审核、用户管理、数据统计等后台管理功能

## 三、核心功能模块

### 1. 用户认证与管理模块

#### 1.1 用户注册
- 支持邮箱注册
- 邮箱验证码验证机制
- 密码强度要求
- 邮箱唯一性检查

#### 1.2 用户登录
- 支持密码登录
- 支持验证码登录
- JWT Token认证机制
- 自动记住登录状态

#### 1.3 密码管理
- 忘记密码功能（通过邮箱验证码重置）
- 修改密码功能
- 密码加密存储（BCrypt）

#### 1.4 个人信息管理
- 查看个人信息
- 修改个人信息（昵称、头像、联系方式等）
- 头像上传功能
- 个人信息展示

#### 1.5 实名认证
- 提交实名认证申请（真实姓名、身份证号、学号、证明文件）
- 查看认证状态（未认证、待审核、已认证、已拒绝）
- 认证审核结果通知
- 认证状态展示

### 2. 失物招领模块

#### 2.1 发布失物信息
- 选择失物类型（丢失物品/招领物品）
- 填写物品信息（标题、描述、类别、地点、时间等）
- 上传物品图片（支持多张）
- 设置物品状态
- 敏感词自动检测
- 发布频率限制

#### 2.2 浏览失物信息
- 失物列表展示（支持分页）
- 多条件筛选（类型、类别、状态、地点等）
- 关键词搜索
- 排序功能（时间、热度等）
- 失物详情查看（包括图片、描述、发布者信息等）

#### 2.3 认领流程
- 申请认领（填写认领信息、上传证明图片）
- 支持多个用户同时申请认领同一件招领物品
- 发布者查看所有认领申请
- 发布者确认认领（自动拒绝其他待处理申请）
- 发布者拒绝认领申请
- 申请人查看自己的申请状态
- 申请人修改或删除认领申请
- 认领结果系统消息通知

#### 2.4 失物管理
- 查看我的发布列表
- 编辑失物信息（仅发布者可编辑）
- 删除失物（逻辑删除）
- 关闭失物（用户下架）
- 查看认领记录

#### 2.5 丢失物品线索功能
- 丢失物品可提供线索
- 线索信息展示

### 3. 闲置交易模块

#### 3.1 发布商品
- 填写商品信息（标题、描述、价格、类别、成色等）
- 上传商品图片（支持多张）
- 设置库存数量
- 选择交易方式（自提/邮寄）
- 敏感词自动检测
- 发布频率限制
- 实名认证检查（发布需要实名认证）

#### 3.2 浏览商品
- 商品列表展示（支持分页）
- 多条件筛选（类别、成色、价格区间、状态等）
- 关键词搜索
- 排序功能（价格、时间、热度等）
- 商品详情查看（包括图片、描述、价格、库存、发布者信息等）

#### 3.3 购买商品
- 创建订单
- 选择交易方式（自提/邮寄）
- 选择收货地址（邮寄方式）
- 库存检查
- 实名认证检查（购买需要实名认证）

#### 3.4 商品管理
- 查看我的发布列表
- 编辑商品信息（仅发布者可编辑）
- 删除商品（逻辑删除）
- 下架/上架商品
- 库存管理

### 4. 订单管理模块

#### 4.1 订单创建
- 从商品创建订单
- 选择交易方式（自提/邮寄）
- 选择收货地址（邮寄方式）
- 设置购买数量
- 库存检查和扣减

#### 4.2 订单状态管理
- 待付款：买家创建订单后，等待付款
- 已付款：买家完成付款
- 已发货：卖家发货（邮寄方式，需填写物流信息）
- 待自提：卖家确认订单（自提方式）
- 已完成：买家确认收货
- 已取消：订单被取消（仅待付款状态可取消）

#### 4.3 订单操作
- 买家付款
- 卖家改价（修改订单价格）
- 卖家发货（填写物流公司和物流单号）
- 买家确认收货
- 取消订单（仅待付款状态）
- 查看订单详情（包括商品信息、价格、状态、时间线等）

#### 4.4 订单列表
- 我的订单列表（买家视角：我买到的）
- 我的订单列表（卖家视角：我卖出的）
- 订单状态筛选
- 交易方式筛选
- 时间范围筛选
- 关键词搜索

### 5. 收货地址管理模块

#### 5.1 地址管理
- 添加收货地址（收货人姓名、手机号、地区、详细地址、邮编）
- 查看地址列表
- 编辑地址信息
- 删除地址（逻辑删除）
- 设置默认地址
- 地址数量限制
- 地址信息验证（手机号、邮编格式验证）

### 6. 学习互助模块

#### 6.1 发布问题
- 选择问题分类（数学、物理、化学、计算机等）
- 填写问题信息（标题、描述、悬赏金额等）
- 上传问题图片（支持多张）
- 敏感词自动检测
- 发布频率限制

#### 6.2 浏览问题
- 问题列表展示（支持分页）
- 多条件筛选（分类、状态、悬赏等）
- 关键词搜索
- 排序功能（时间、悬赏、热度等）
- 问题详情查看（包括图片、描述、发布者信息、回答列表等）

#### 6.3 回答问题
- 查看问题详情
- 提交回答（支持文字、图片）
- 查看所有回答
- 回答列表展示

#### 6.4 采纳答案
- 发布者采纳最佳答案
- 问题状态更新（已解决）
- 采纳结果通知

#### 6.5 问题管理
- 查看我的问题列表
- 查看我的回答列表
- 编辑问题（仅发布者可编辑）
- 删除问题（逻辑删除）
- 取消问题

### 7. 聊天功能模块

#### 7.1 会话管理
- 创建或获取会话（自动创建或获取已有会话）
- 会话列表展示（显示所有聊天会话）
- 会话详情查看
- 会话关联（关联商品、订单等）

#### 7.2 消息发送
- 发送文字消息
- 发送图片消息（支持图片上传）
- 发送商品卡片消息（在聊天中发送商品链接）
- 发送订单卡片消息（在聊天中发送订单信息）
- 多行文本输入（支持换行）
- 快捷键操作（Shift+Enter换行，Enter发送）

#### 7.3 消息接收
- 消息列表展示（显示会话中的所有消息）
- 实时消息推送（WebSocket）
- 消息已读状态显示（实时更新）
- 消息时间显示
- 图片预览功能
- 消息气泡样式（发送/接收区分）

#### 7.4 已读状态
- 消息已读状态管理
- 已读状态实时更新
- 已读状态显示（圆形打勾图标）

### 8. 系统消息模块

#### 8.1 消息类型
- 实名认证审核结果通知
- 失物认领通知（认领申请、确认认领、拒绝认领）
- 失物审核通知（审核通过、审核拒绝）
- 商品审核通知（审核通过、审核拒绝）
- 问题审核通知（审核通过、审核拒绝）
- 管理员审核提醒（待审核内容提醒）
- 系统公告
- 其他业务通知

#### 8.2 消息功能
- 消息列表展示（分页显示）
- 未读消息数量显示
- 标记消息为已读
- 全部标记为已读
- 标记聊天相关消息为已读
- 删除消息（逻辑删除）
- 批量删除消息（支持全选、单选）
- 消息类型分类显示（不同类型显示不同颜色和图标）
- 消息点击跳转（根据消息类型跳转到相关页面）

#### 8.3 消息通知面板
- 右下角消息通知按钮（带未读数量徽章）
- 消息通知面板（显示最近消息）
- 点击外部区域自动关闭
- 实时消息推送（WebSocket）
- 根据消息类型显示不同颜色和图标

### 9. 搜索历史模块

#### 9.1 搜索历史功能
- 自动保存搜索历史（失物招领、闲置交易、学习互助）
- 搜索历史展示（标签形式）
- 快速选择历史搜索
- 删除单个搜索历史
- 清空搜索历史
- 搜索历史去重
- 搜索历史数量限制

### 10. 管理员后台模块

#### 10.1 数据概览
- 数据统计信息展示（用户数、内容数、订单数等）
- 数据图表展示（趋势图、分布图等）
- 每日趋势数据
- 用户统计数据
- 互助类型分布
- 统计周期选择（最近7天、最近30天、本学期、本学年）

#### 10.2 用户管理
- 用户列表查询（支持分页）
- 用户详情查看
- 用户信息编辑
- 新增用户
- 删除用户
- 用户封禁（临时封禁/永久封禁）
- 用户解封
- 用户状态管理

#### 10.3 实名认证审核
- 待审核认证列表（支持按状态筛选）
- 认证详情查看
- 审核认证（通过/拒绝）
- 审核原因记录
- 审核结果通知

#### 10.4 内容审核
- **失物招领审核**
  - 待审核失物列表（支持多条件筛选）
  - 失物详情查看
  - 审核失物（通过/拒绝）
  - 审核原因记录
  - 下架违规失物
  - 审核结果通知

- **闲置交易审核**
  - 待审核商品列表（支持多条件筛选）
  - 商品详情查看
  - 审核商品（通过/拒绝）
  - 审核原因记录
  - 下架违规商品
  - 审核结果通知

- **学习问题审核**
  - 待审核问题列表（支持多条件筛选）
  - 问题详情查看
  - 审核问题（通过/拒绝）
  - 审核原因记录
  - 下架违规问题
  - 回答审核（审核/删除回答）
  - 审核结果通知

#### 10.5 内容管理
- 失物招领管理（查看所有失物、下架、删除等）
- 闲置交易管理（查看所有商品、下架、删除等）
- 学习互助管理（查看所有问题、下架、删除等）

#### 10.6 敏感词管理
- 敏感词列表查看（支持搜索、分页）
- 添加敏感词（支持普通/严重敏感词分级）
- 编辑敏感词
- 删除敏感词
- 批量删除敏感词
- 重新加载敏感词库
- 敏感词检测机制（AC自动机算法）

#### 10.7 管理员消息
- 查看所有管理员消息
- 消息通知面板（管理员版，支持实时推送）
- 待审核内容提醒

## 四、系统特性

### 1. 安全特性
- JWT Token认证机制
- BCrypt密码加密
- 验证码防刷机制（基于IP和邮箱）
- 验证码有效期管理
- 基于角色的访问控制（ROLE_USER、ROLE_ADMIN）
- 方法级权限控制

### 2. 内容审核机制
- 敏感词自动检测（使用AC自动机算法）
- 敏感词分级（普通/严重）
- 严重敏感词：自动拒绝并保存记录
- 普通敏感词：转人工审核
- 发布频率限制（防止恶意刷屏）
- 内容审核流程（自动审核/人工审核）

### 3. 实时通信
- WebSocket实时消息推送（STOMP协议）
- 消息持久化存储
- 已读状态实时更新
- 自动连接/重连机制
- JWT认证拦截器（WebSocket连接时进行身份验证）

### 4. 文件管理
- 图片上传（支持jpg、jpeg、png、gif）
- 文件大小限制（5MB）
- 按模块分类存储（avatar、lost-found、goods、chat、study、verification等）
- 按日期自动创建目录
- 返回可访问的URL路径

### 5. 数据管理
- 逻辑删除机制（所有表统一使用delete_flag字段）
- 查询时自动过滤已删除数据
- 数据统计功能
- 分页查询支持

### 6. 业务逻辑特性
- 认领流程管理（支持多认领申请）
- 确认认领时自动拒绝其他申请并发送通知
- 订单状态流转管理
- 库存检查和乐观锁机制
- 交易方式支持（自提/邮寄）
- 订单价格修改记录
- 问题采纳机制
- 悬赏机制（可选）

## 五、用户使用流程

### 1. 新用户注册流程
1. 访问注册页面
2. 填写邮箱、密码等信息
3. 获取并输入邮箱验证码
4. 提交注册
5. 注册成功后自动登录

### 2. 失物招领使用流程
**发布失物：**
1. 登录系统
2. 进入失物招领模块
3. 点击发布失物
4. 填写失物信息并上传图片
5. 提交发布
6. 等待审核（自动审核或人工审核）
7. 审核通过后失物信息展示在列表中

**认领失物：**
1. 浏览失物列表或搜索失物
2. 查看失物详情
3. 点击申请认领
4. 填写认领信息并上传证明图片
5. 提交认领申请
6. 等待发布者确认
7. 收到认领结果通知

### 3. 闲置交易使用流程
**发布商品：**
1. 完成实名认证
2. 进入闲置交易模块
3. 点击发布商品
4. 填写商品信息并上传图片
5. 设置价格、库存、交易方式等
6. 提交发布
7. 等待审核（自动审核或人工审核）
8. 审核通过后商品信息展示在列表中

**购买商品：**
1. 完成实名认证
2. 浏览商品列表或搜索商品
3. 查看商品详情
4. 点击购买
5. 选择交易方式和收货地址
6. 创建订单
7. 支付订单
8. 等待卖家发货（邮寄方式）或确认订单（自提方式）
9. 确认收货
10. 订单完成

### 4. 学习互助使用流程
**发布问题：**
1. 进入学习互助模块
2. 点击发布问题
3. 选择问题分类
4. 填写问题信息（可设置悬赏金额）
5. 上传问题图片（可选）
6. 提交发布
7. 等待审核（自动审核或人工审核）
8. 审核通过后问题展示在列表中

**回答问题：**
1. 浏览问题列表或搜索问题
2. 查看问题详情
3. 点击回答问题
4. 填写回答内容（可上传图片）
5. 提交回答
6. 等待发布者采纳（如果设置了悬赏）

### 5. 聊天使用流程
1. 在商品详情页或订单详情页点击"联系卖家/买家"
2. 自动创建或获取会话
3. 进入聊天页面
4. 发送消息（文字、图片、商品卡片、订单卡片）
5. 接收实时消息推送
6. 查看消息已读状态

## 六、管理员工作流程

### 1. 内容审核流程
1. 登录管理员后台
2. 进入相应的审核页面（失物招领审核/闲置交易审核/学习问题审核）
3. 查看待审核列表
4. 点击查看详情
5. 审核内容（通过/拒绝）
6. 填写审核原因（拒绝时必填）
7. 提交审核
8. 系统自动发送审核结果通知给发布者

### 2. 用户管理流程
1. 进入用户管理页面
2. 查看用户列表
3. 查看用户详情
4. 执行操作（封禁/解封/编辑/删除）
5. 填写操作原因（封禁时必填）
6. 提交操作

### 3. 实名认证审核流程
1. 进入实名认证审核页面
2. 查看待审核认证列表
3. 查看认证详情和证明文件
4. 审核认证（通过/拒绝）
5. 填写审核原因（拒绝时必填）
6. 提交审核
7. 系统自动发送审核结果通知给用户

### 4. 敏感词管理流程
1. 进入敏感词管理页面
2. 查看敏感词列表
3. 添加/编辑/删除敏感词
4. 设置敏感词级别（普通/严重）
5. 重新加载敏感词库（使新添加的敏感词生效）

## 七、系统技术特性

### 1. 前端技术
- Vue 3框架
- Element Plus UI组件库
- Pinia状态管理
- Vue Router路由管理
- Axios HTTP客户端
- WebSocket实时通信（SockJS + STOMP.js）
- ECharts图表库

### 2. 后端技术
- Spring Boot框架
- MyBatis Plus ORM
- Spring Security安全框架
- JWT认证
- WebSocket实时通信（STOMP）
- Redis缓存（可选）
- JavaMail邮件服务
- Druid连接池

### 3. 数据库
- MySQL 8.0+
- 逻辑删除机制
- 事务管理

## 八、系统限制与规则

### 1. 用户限制
- 发布频率限制（防止恶意刷屏）
- 地址数量限制
- 搜索历史数量限制

### 2. 内容限制
- 敏感词检测（自动拒绝严重敏感词，普通敏感词转人工审核）
- 内容审核机制（自动审核/人工审核）
- 实名认证要求（发布和购买商品需要实名认证）

### 3. 文件限制
- 图片格式限制（jpg、jpeg、png、gif）
- 文件大小限制（5MB）

### 4. 业务规则
- 订单状态流转规则（只能按顺序流转）
- 取消订单规则（仅待付款状态可取消）
- 认领规则（支持多认领申请，确认时自动拒绝其他申请）
- 采纳答案规则（一个问题只能采纳一个答案）

## 九、系统功能完成度

根据系统开发情况，当前核心功能完成度：

- ✅ **用户管理模块**: 100%
- ✅ **失物招领模块**: 100%
- ✅ **闲置交易模块**: 100%
- ✅ **学习互助模块**: 100%
- ✅ **消息通知模块**: 100%
- ✅ **管理员功能**: 100%
- ✅ **订单管理模块**: 100%
- ✅ **地址管理模块**: 100%
- ✅ **搜索历史模块**: 100%
- ✅ **敏感词管理**: 100%
- ✅ **聊天功能模块**: 100%

**总体完成度**: 核心功能已全部实现 ✅

## 十、待实现功能

### 核心功能
- 跑腿服务模块（errand_task）
  - 跑腿任务发布
  - 跑腿任务接单
  - 跑腿任务管理
  - 跑腿任务评价

### 可选功能
- 评论功能模块（comment）
  - 商品评论
  - 失物评论
  - 评论回复

- 收藏功能模块（favorite）
  - 商品收藏
  - 失物收藏
  - 收藏列表管理

- 订单评价功能
  - 买卖双方评价
  - 评价展示

### 功能优化
- 搜索功能优化（全局搜索、高级搜索）
- 商品/问题排序优化
- 更多数据统计图表
- 消息推送通知（浏览器通知）
- 移动端适配优化

## 十一、总结

校园帮系统是一个功能完善的综合性校园互助平台，涵盖了失物招领、闲置交易、学习互助等核心功能，并提供了完善的用户管理、内容审核、实时通信等辅助功能。系统采用现代化的技术栈，具有良好的扩展性和可维护性，能够满足高校学生的日常互助需求。

